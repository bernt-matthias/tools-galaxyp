<?xml version='1.0' encoding='UTF-8'?>
<!--This is a configuration file for the integration of a tools into Galaxy (https://galaxyproject.org/). This file was automatically generated using CTDConverter.-->
<!--Proposed Tool Section: [ID Processing]-->
<tool id="IDFileConverter" name="IDFileConverter" version="@TOOL_VERSION@+galaxy@GALAXY_VERSION@" profile="20.05">
  <description>Converts identification engine file formats.</description>
  <macros>
    <token name="@EXECUTABLE@">IDFileConverter</token>
    <import>macros.xml</import>
    <import>macros_autotest.xml</import>
    <import>macros_test.xml</import>
  </macros>
  <expand macro="requirements"/>
  <expand macro="stdio"/>
  <command detect_errors="exit_code"><![CDATA[@QUOTE_FOO@
@EXT_FOO@
#import re

## Preprocessing
mkdir in &&
ln -s '$in' 'in/${re.sub("[^\w\-_]", "_", $in.element_identifier)}.$gxy2omsext($in.ext)' &&
mkdir out &&
#if $mz_file:
  mkdir mz_file &&
  ln -s '$mz_file' 'mz_file/${re.sub("[^\w\-_]", "_", $mz_file.element_identifier)}.$gxy2omsext($mz_file.ext)' &&
#end if

## Main program call

set -o pipefail &&
@EXECUTABLE@ -write_ctd ./ &&
python3 '$__tool_directory__/fill_ctd.py' '@EXECUTABLE@.ctd' '$args_json' '$hardcoded_json' &&
@EXECUTABLE@ -ini @EXECUTABLE@.ctd
-in
'in/${re.sub("[^\w\-_]", "_", $in.element_identifier)}.$gxy2omsext($in.ext)'
-out
'out/output.${out_type}'
#if $mz_file:
  -mz_file
  'mz_file/${re.sub("[^\w\-_]", "_", $mz_file.element_identifier)}.$gxy2omsext($mz_file.ext)'
#end if

## Postprocessing
&& mv 'out/output.${out_type}' '$out'
#if "ctd_out_FLAG" in $OPTIONAL_OUTPUTS
  && mv '@EXECUTABLE@.ctd' '$ctd_out'
#end if]]></command>
  <configfiles>
    <inputs name="args_json" data_style="paths"/>
    <configfile name="hardcoded_json"><![CDATA[{"log": "log.txt", "threads": "\${GALAXY_SLOTS:-1}", "no_progress": true}]]></configfile>
  </configfiles>
  <inputs>
    <param name="in" argument="-in" type="data" format="idxml,mascotxml,mzid,pepxml,protxml,psms,tabular,xml,xquest.xml" optional="false" label="Input file or directory containing the data to convert" help="This may be:. - a single file in a multi-purpose XML format (.pepXML, .protXML, .idXML, .mzid),. - a single file in a search engine-specific format (Mascot: .mascotXML, OMSSA: .omssaXML, X! Tandem: .xml, Percolator: .psms, xQuest: .xquest.xml),. - a single file in fasta format (can only be used to generate a theoretical mzML),. - a single text file (tab separated) with one line for all peptide sequences matching a spectrum (top N hits),. - for Sequest results, a directory containing .out files..  select idxml,mascotxml,mzid,pepxml,protxml,psms,tabular,xml,xquest.xml data sets(s)"/>
    <param name="out_type" argument="-out_type" type="select" optional="false" label="Output file type (default: determined from file extension)" help="">
      <option value="FASTA">fasta</option>
      <option value="idXML">idxml</option>
      <option value="mzML">mzml</option>
      <option value="mzid">mzid</option>
      <option value="pepXML">pepxml</option>
      <option value="xquest.xml">xquest.xml</option>
      <expand macro="list_string_san" name="out_type"/>
    </param>
    <param name="mz_file" argument="-mz_file" type="data" format="mzdata,mzml,mzxml" optional="true" label="[pepXML, Sequest, Mascot, X" help="Tandem, mzid, Percolator only] Retention times and native spectrum ids (spectrum_references) will be looked up in this file select mzdata,mzml,mzxml data sets(s)"/>
    <param name="mz_name" argument="-mz_name" type="text" optional="true" value="" label="[pepXML only] Experiment filename/path (extension will be removed) to match in the pepXML file ('base_name' attribute)" help="Only necessary if different from 'mz_file'">
      <expand macro="list_string_san" name="mz_name"/>
    </param>
    <param name="peptideprophet_analyzed" argument="-peptideprophet_analyzed" type="boolean" truevalue="true" falsevalue="false" checked="false" label="[pepXML output only] Write output in the format of a PeptideProphet analysis result" help="By default a 'raw' pepXML is produced that contains only search engine results"/>
    <param name="score_type" argument="-score_type" display="checkboxes" type="select" optional="false" label="[Percolator only] Which of the Percolator scores to report as 'the' score for a peptide hit" help="">
      <option value="qvalue" selected="true">qvalue</option>
      <option value="PEP">PEP</option>
      <option value="score">score</option>
      <expand macro="list_string_san" name="score_type"/>
    </param>
    <section name="fasta_to_mzml" title="[FASTA input + MzML output only] Parameters used to adjust simulation of the theoretical spectra" help="" expanded="false">
      <param name="isotope_model" argument="-fasta_to_mzml:isotope_model" display="checkboxes" type="select" optional="false" label="Model to use for isotopic peaks ('none' means no isotopic peaks are added, 'coarse' adds isotopic peaks in unit mass distance, 'fine' uses the hyperfine isotopic generator to add accurate isotopic peaks" help="Note that adding isotopic peaks is very slow">
        <option value="none" selected="true">none</option>
        <option value="coarse">coarse</option>
        <option value="fine">fine</option>
        <expand macro="list_string_san" name="isotope_model"/>
      </param>
      <param name="max_isotope" argument="-fasta_to_mzml:max_isotope" type="integer" optional="false" value="2" label="Defines the maximal isotopic peak which is added if 'isotope_model' is 'coarse'" help=""/>
      <param name="max_isotope_probability" argument="-fasta_to_mzml:max_isotope_probability" type="float" optional="false" value="0.05" label="Defines the maximal isotopic probability to cover if 'isotope_model' is 'fine'" help=""/>
      <param name="add_metainfo" argument="-fasta_to_mzml:add_metainfo" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Adds the type of peaks as metainfo to the peaks, like y8+, [M-H2O+2H]++" help=""/>
      <param name="add_losses" argument="-fasta_to_mzml:add_losses" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Adds common losses to those ion expect to have them, only water and ammonia loss is considered" help=""/>
      <param name="sort_by_position" argument="-fasta_to_mzml:sort_by_position" type="boolean" truevalue="true" falsevalue="false" checked="true" label="Sort output by position" help=""/>
      <param name="add_precursor_peaks" argument="-fasta_to_mzml:add_precursor_peaks" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Adds peaks of the unfragmented precursor ion to the spectrum" help=""/>
      <param name="add_all_precursor_charges" argument="-fasta_to_mzml:add_all_precursor_charges" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Adds precursor peaks with all charges in the given range" help=""/>
      <param name="add_abundant_immonium_ions" argument="-fasta_to_mzml:add_abundant_immonium_ions" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Add most abundant immonium ions" help=""/>
      <param name="add_first_prefix_ion" argument="-fasta_to_mzml:add_first_prefix_ion" type="boolean" truevalue="true" falsevalue="false" checked="false" label="If set to true e.g. b1 ions are added" help=""/>
      <param name="add_y_ions" argument="-fasta_to_mzml:add_y_ions" type="boolean" truevalue="true" falsevalue="false" checked="true" label="Add peaks of y-ions to the spectrum" help=""/>
      <param name="add_b_ions" argument="-fasta_to_mzml:add_b_ions" type="boolean" truevalue="true" falsevalue="false" checked="true" label="Add peaks of b-ions to the spectrum" help=""/>
      <param name="add_a_ions" argument="-fasta_to_mzml:add_a_ions" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Add peaks of a-ions to the spectrum" help=""/>
      <param name="add_c_ions" argument="-fasta_to_mzml:add_c_ions" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Add peaks of c-ions to the spectrum" help=""/>
      <param name="add_x_ions" argument="-fasta_to_mzml:add_x_ions" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Add peaks of  x-ions to the spectrum" help=""/>
      <param name="add_z_ions" argument="-fasta_to_mzml:add_z_ions" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Add peaks of z-ions to the spectrum" help=""/>
      <param name="y_intensity" argument="-fasta_to_mzml:y_intensity" type="float" optional="false" value="1.0" label="Intensity of the y-ions" help=""/>
      <param name="b_intensity" argument="-fasta_to_mzml:b_intensity" type="float" optional="false" value="1.0" label="Intensity of the b-ions" help=""/>
      <param name="a_intensity" argument="-fasta_to_mzml:a_intensity" type="float" optional="false" value="1.0" label="Intensity of the a-ions" help=""/>
      <param name="c_intensity" argument="-fasta_to_mzml:c_intensity" type="float" optional="false" value="1.0" label="Intensity of the c-ions" help=""/>
      <param name="x_intensity" argument="-fasta_to_mzml:x_intensity" type="float" optional="false" value="1.0" label="Intensity of the x-ions" help=""/>
      <param name="z_intensity" argument="-fasta_to_mzml:z_intensity" type="float" optional="false" value="1.0" label="Intensity of the z-ions" help=""/>
      <param name="relative_loss_intensity" argument="-fasta_to_mzml:relative_loss_intensity" type="float" optional="false" value="0.1" label="Intensity of loss ions, in relation to the intact ion intensity" help=""/>
      <param name="precursor_intensity" argument="-fasta_to_mzml:precursor_intensity" type="float" optional="false" value="1.0" label="Intensity of the precursor peak" help=""/>
      <param name="precursor_H2O_intensity" argument="-fasta_to_mzml:precursor_H2O_intensity" type="float" optional="false" value="1.0" label="Intensity of the H2O loss peak of the precurso" help=""/>
      <param name="precursor_NH3_intensity" argument="-fasta_to_mzml:precursor_NH3_intensity" type="float" optional="false" value="1.0" label="Intensity of the NH3 loss peak of the precurso" help=""/>
      <param name="enzyme" argument="-fasta_to_mzml:enzyme" type="select" optional="false" label="Enzym used to digest the fasta proteins" help="">
        <option value="Asp-N/B">Asp-N/B</option>
        <option value="Asp-N_ambic">Asp-N_ambic</option>
        <option value="Chymotrypsin">Chymotrypsin</option>
        <option value="Chymotrypsin/P">Chymotrypsin/P</option>
        <option value="CNBr">CNBr</option>
        <option value="glutamyl endopeptidase">glutamyl endopeptidase</option>
        <option value="Alpha-lytic protease">Alpha-lytic protease</option>
        <option value="2-iodobenzoate">2-iodobenzoate</option>
        <option value="iodosobenzoate">iodosobenzoate</option>
        <option value="staphylococcal protease/D">staphylococcal protease/D</option>
        <option value="proline-endopeptidase/HKR">proline-endopeptidase/HKR</option>
        <option value="Glu-C+P">Glu-C+P</option>
        <option value="PepsinA + P">PepsinA + P</option>
        <option value="cyanogen-bromide">cyanogen-bromide</option>
        <option value="Clostripain/P">Clostripain/P</option>
        <option value="elastase-trypsin-chymotrypsin">elastase-trypsin-chymotrypsin</option>
        <option value="no cleavage">no cleavage</option>
        <option value="unspecific cleavage">unspecific cleavage</option>
        <option value="Formic_acid">Formic_acid</option>
        <option value="Lys-C">Lys-C</option>
        <option value="Arg-C">Arg-C</option>
        <option value="Arg-C/P">Arg-C/P</option>
        <option value="Asp-N">Asp-N</option>
        <option value="Trypsin/P">Trypsin/P</option>
        <option value="V8-DE">V8-DE</option>
        <option value="V8-E">V8-E</option>
        <option value="leukocyte elastase">leukocyte elastase</option>
        <option value="proline endopeptidase">proline endopeptidase</option>
        <option value="Lys-N">Lys-N</option>
        <option value="Lys-C/P">Lys-C/P</option>
        <option value="PepsinA">PepsinA</option>
        <option value="TrypChymo">TrypChymo</option>
        <option value="Trypsin" selected="true">Trypsin</option>
        <expand macro="list_string_san" name="enzyme"/>
      </param>
      <param name="missed_cleavages" argument="-fasta_to_mzml:missed_cleavages" type="integer" optional="false" value="0" label="Number of allowed missed cleavages while digesting the fasta proteins" help=""/>
      <param name="min_charge" argument="-fasta_to_mzml:min_charge" type="integer" optional="false" value="1" label="Minimum charge" help=""/>
      <param name="max_charge" argument="-fasta_to_mzml:max_charge" type="integer" optional="false" value="1" label="Maximum charge" help=""/>
      <param name="precursor_charge" argument="-fasta_to_mzml:precursor_charge" type="integer" optional="false" value="0" label="Manually set precursor charge" help="(default: 0, meaning max_charge + 1 will be used as precursor charge)"/>
    </section>
    <expand macro="adv_opts_macro">
      <param name="ignore_proteins_per_peptide" argument="-ignore_proteins_per_peptide" type="boolean" truevalue="true" falsevalue="false" checked="false" label="[Sequest only] Workaround to deal with .out files that contain" help="e.g. &quot;+1&quot; in references column,. but do not list extra references in subsequent lines (try -debug 3 or 4)"/>
      <param name="scan_regex" argument="-scan_regex" type="text" optional="true" value="" label="[Mascot, pepXML, Percolator only] Regular expression used to extract the scan number or retention time" help="See documentation for details">
        <expand macro="list_string_san" name="scan_regex"/>
      </param>
      <param name="no_spectra_data_override" argument="-no_spectra_data_override" type="boolean" truevalue="true" falsevalue="false" checked="false" label="[+mz_file only] Setting this flag will avoid overriding 'spectra_data' in ProteinIdentifications if mz_file is given and 'spectrum_reference's are added/updated" help="Use only if you are sure it is absolutely the same mz_file as used for identification"/>
      <param name="no_spectra_references_override" argument="-no_spectra_references_override" type="boolean" truevalue="true" falsevalue="false" checked="false" label="[+mz_file only] Setting this flag will avoid overriding 'spectrum_reference' in PeptideIdentifications if mz_file is given and a 'spectrum_reference' is already present" help=""/>
      <param name="add_ionmatch_annotation" argument="-add_ionmatch_annotation" type="float" optional="false" value="0.0" label="[+mz_file only] Will annotate the contained identifications with their matches in the given mz_file" help="Will take quite some while. Match tolerance is .4"/>
      <param name="concatenate_peptides" argument="-concatenate_peptides" type="boolean" truevalue="true" falsevalue="false" checked="false" label="[FASTA output only] Will concatenate the top peptide hits to one peptide sequence, rather than write a new peptide for each hit" help=""/>
      <param name="number_of_hits" argument="-number_of_hits" type="integer" optional="false" value="1" label="[FASTA output only] Controls how many peptide hits will be exported" help="A value of 0 or less exports all hits"/>
      <param name="force" argument="-force" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Overrides tool-specific checks" help=""/>
      <param name="test" argument="-test" type="hidden" optional="false" value="False" label="Enables the test mode (needed for internal use only)" help="">
        <expand macro="list_string_san" name="test"/>
      </param>
    </expand>
    <param name="OPTIONAL_OUTPUTS" type="select" optional="true" multiple="true" label="Optional outputs">
      <option value="ctd_out_FLAG">Output used ctd (ini) configuration file</option>
    </param>
  </inputs>
  <outputs>
    <data name="out" label="${tool.name} on ${on_string}: out" format="fasta">
      <change_format>
        <when input="out_type" value="idXML" format="idxml"/>
        <when input="out_type" value="mzML" format="mzml"/>
        <when input="out_type" value="mzid" format="mzid"/>
        <when input="out_type" value="pepXML" format="pepxml"/>
        <when input="out_type" value="xquest.xml" format="xquest.xml"/>
      </change_format>
    </data>
    <data name="ctd_out" format="xml" label="${tool.name} on ${on_string}: ctd">
      <filter>OPTIONAL_OUTPUTS is not None and "ctd_out_FLAG" in OPTIONAL_OUTPUTS</filter>
    </data>
  </outputs>
  <tests>
    <expand macro="autotest_IDFileConverter"/>
    <expand macro="manutest_IDFileConverter"/>
  </tests>
  <help><![CDATA[Converts identification engine file formats.


For more information, visit http://www.openms.de/doxygen/nightly/html/TOPP_IDFileConverter.html]]></help>
  <expand macro="references"/>
</tool>
