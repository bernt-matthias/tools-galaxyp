<macros>
    <token name="@MSFRAGGER_VERSION@">3.5</token>
    <xml name="msfragger_inputs">
        <expand macro="scan_inputs"/>
        <expand macro="fragger_database"/>
        <expand macro="default_config"/>
        <expand macro="output_format"/>
    </xml>

    <token name="@CMD_IMPORTS@">
#import re
#def identifier_or_name($input1)
    #if hasattr($input1, 'element_identifier')
        #return $input1.element_identifier
    #else
        #return $input1.name
    #end if
#end def
#def clean($name1)
    #set $name_clean = $re.sub('[^\w\-_]', '_', $re.sub('(?i)[.](fa|fas|fasta|imzml|mzml|mzxml|raw)$','', $re.sub('.*/','', $name1.rstrip('.gz'))))
    #return $name_clean
#end def
#def ln_name($ds) 
    #set $ext = ''
    #if $ds.is_of_type('mzml') or $ds.is_of_type('imzml')
        #set $ext = ".mzML"
    #else if $ds.is_of_type('mzxml')
        #set $ext = ".mzXML"
    #else if $ds.is_of_type('mgf')
        #set $ext = ".mgf"
    #else if $ds.is_of_type('thermo.raw')
        #set $ext = ".raw"
    #else if $ds.is_of_type('fasta')
        #set $ext = ".fasta"
    #end if
    #set $name = "%s%s" % ($clean($identifier_or_name($ds)),$ext) 
    #return $name
#end def
#set $i_names = []
#set $db_name = None
    </token>

    <xml name="scan_inputs" token_scanformat="thermo.raw,mzml,imzml,mzxmli,mgf">
        <param name="inputs" type="data" format="@SCANFORMAT@" multiple="true" label="Proteomics Spectrum files"  help="Thermo RAW, mzML, mzXML, MGF formats"/>
        <param name="input_prefix" type="text" value="" optional="true" label="File name prefix" help="Names inputs: prefix_rep#.mzXML Leave blank to use History names of inputs">
              <validator type="regex" message="">[a-zA-Z][a-zA-Z0-9_-]*</validator>
        </param>
        <param name="data_type" type="select" label="Data type">
            <option value="DDA">DDA</option>
            <option value="DIA">DIA</option>
            <option value="GPF-DIA">GPF-DIA</option>
            <option value="DIA-Quant">DIA-Quant</option>
            <option value="DIA-Lib">DIA-Lib</option>
        </param>
    </xml>
    <token name="@LINK_SCAN_INPUTS@"><![CDATA[
    #for $sf in $inputs
      #set $i_name = $ln_name($sf)
      #silent $i_names.append($i_name)
      ln -s '$sf' '$i_name' &&
    #end for
    ]]></token>
    <token name="@SCAN_INPUTS@">
    #for $si in $i_names
        '$si'
    #end for
    </token>

    <xml name="fragger_database">
        <param name="database_name" argument="database_name" type="data" format="fasta" label="Proteomics Search Database in FASTA format"/>
        <param name="decoy_prefix" type="text" value="rev_" label="Prefix of the decoy protein entries." help="Used for parameter optimization only."/>
    </xml>
    <token name="@FRAGGER_DATABASE@">
    #set $db_name = $ln_name($database_name)
    </token>
    <token name="@LINK_FRAGGER_DATABASE@"><![CDATA[
    @FRAGGER_DATABASE@
    ln -s '$database_name' '$db_name' &&
    ]]></token>
    <token name="@FASTA_INPUT@">
    </token>

    <xml name="closed_search">
        <expand macro="search_tolerances"/>
        <expand macro="digestion"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing"/>
        <expand macro="open_search_options"/>
        <expand macro="modeling_output"/>
    </xml>
    <xml name="open_search">
        <expand macro="search_tolerances"/>
        <expand macro="digestion"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing" mode_selected="false" mode_corrected="true"/>
        <expand macro="open_search_options" localize="true"/>
        <expand macro="modeling_output"/>
    </xml>
    <xml name="nonspecific_HLA">
        <expand macro="search_tolerances" precursor_mass_lower="-20" precursor_mass_upper="20"/>
        <expand macro="digestion" stricttrypsin="false" nonspecific="true" digest_max_length="25" termini_0="true" termini_2="false"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing"/>
        <expand macro="open_search_options"/>
        <expand macro="modeling_output"/>
    </xml>
    <xml name="nonspecific_peptidome">
        <expand macro="search_tolerances" precursor_mass_lower="-20" precursor_mass_upper="20" fragment_mass_tolerance="25"/>
        <expand macro="digestion" stricttrypsin="false" nonspecific="true" digest_max_length="65" termini_0="true" termini_2="false"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing"/>
        <expand macro="open_search_options"/>
        <expand macro="modeling_output"/>
    </xml>
    <xml name="Nglyco-HCD">
        <expand macro="search_tolerances" precursor_mass_lower="-20" precursor_mass_upper="20"/>
        <expand macro="digestion"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing"/>
        <expand macro="open_search_options"/>
        <expand macro="modeling_output"/>
    </xml>
    <xml name="Nglyco-hybrid">
        <expand macro="search_tolerances" precursor_mass_lower="-20" precursor_mass_upper="20"/>
        <expand macro="digestion"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing"/>
        <expand macro="open_search_options"/>
        <expand macro="modeling_output"/>
    </xml>
    <xml name="Oglyco-HCD">
        <expand macro="search_tolerances" precursor_mass_lower="-20" precursor_mass_upper="20"/>
        <expand macro="digestion"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing"/>
        <expand macro="open_search_options"/>
        <expand macro="modeling_output"/>
    </xml>
    <xml name="Oglyco-hybrid">
        <expand macro="search_tolerances" precursor_mass_lower="-20" precursor_mass_upper="20"/>
        <expand macro="digestion"/>
        <expand macro="variable_modification"/>
        <expand macro="static_modification"/>
        <expand macro="glyco_labile"/>
        <expand macro="mass_offsets"/>
        <expand macro="spectrum_processing"/>
        <expand macro="open_search_options"/>
        <expand macro="modeling_output"/>
    </xml>

    <xml name="default_config">
        <conditional name="cfg">
            <param name="default_config" type="select" label="Default configuration">
                <option value="history">Use MSFragger params from history</option> 
                <option value="closed_search" selected="true">Closed search</option> 
                <option value="open_search">Open search</option> 
                <option value="nonspecific_HLA">Nonspecific-HLA search</option> 
                <option value="nonspecific_peptidome">Nonspecific-peptidome search</option> 
                <option value="Nglyco-HCD">Nglyco-HCD search</option> 
                <option value="Nglyco-hybrid">Nglyco-hybrid search</option> 
                <option value="Oglyco-HCD">Oglyco-HCD search</option> 
                <option value="Oglyco-hybrid">Oglyco-hybrid search</option> 
            </param>
            <when value="history">
                 <param name="msfragger_params" type="data" format="txt" label="MSFragger params"/> 
            </when>
            <when value="closed_search">
                <expand macro="closed_search"/>
            </when>
            <when value="open_search">
                <expand macro="open_search"/>
            </when>
            <when value="nonspecific_HLA">
                <expand macro="nonspecific_HLA"/>
            </when>
            <when value="nonspecific_peptidome">
                <expand macro="nonspecific_peptidome"/>
            </when>
            <when value="Nglyco-HCD">
                <expand macro="Nglyco-HCD"/>
            </when>
            <when value="Nglyco-hybrid">
                <expand macro="Nglyco-hybrid"/>
            </when>
            <when value="Oglyco-HCD">
                <expand macro="Oglyco-HCD"/>
            </when>
            <when value="Oglyco-hybrid">
                <expand macro="Oglyco-hybrid"/>
            </when>

        </conditional>
    </xml>

    <token name="@DEFAULT_DICT@">#slurp
## Search Tolerances

#if $prefix.search_tolerances.precursor.precursor_mass_units == 'Da'
  #set $msfragger_dict['precursor_mass_units'] = 0
#elif $prefix.search_tolerances.precursor.precursor_mass_units == 'ppm'
  #set $msfragger_dict['precursor_mass_units'] = 1
#end if
#if $prefix.search_tolerances.precursor.precursor_mass_units != 'default'
  #if $prefix.search_tolerances.precursor.precursor_mass_lower is not None
    #set $msfragger_dict['precursor_mass_lower'] = $prefix.search_tolerances.precursor.precursor_mass_lower
  #end if
  #if $prefix.search_tolerances.precursor.precursor_mass_upper is not None
    #set $msfragger_dict['precursor_mass_upper'] = $prefix.search_tolerances.precursor.precursor_mass_upper
  #end if
#end if

#if $prefix.search_tolerances.precursor_true.precursor_true_units == 'Da'
  #set $msfragger_dict['precursor_true_units'] = 0
#elif $prefix.search_tolerances.precursor_true.precursor_true_units == 'ppm'
  #set $msfragger_dict['precursor_true_units'] = 1
#end if
#if $prefix.search_tolerances.precursor_true.precursor_true_units != 'default'
  #if str($prefix.search_tolerances.precursor_true.precursor_true_tolerance).strip()
    #set $msfragger_dict['precursor_true_tolerance'] = $prefix.search_tolerances.precursor_true.precursor_true_tolerance
  #end if
#end if

#if $prefix.search_tolerances.fragment.fragment_mass_units == 'Da'
  #set $msfragger_dict['fragment_mass_units'] = 0
#elif $prefix.search_tolerances.fragment.fragment_mass_units == 'ppm'
  #set $msfragger_dict['fragment_mass_units'] = 1
#end if
#if $prefix.search_tolerances.fragment.fragment_mass_units != 'default'
  #if $prefix.search_tolerances.fragment.fragment_mass_tolerance is not None
    #set $msfragger_dict['fragment_mass_tolerance'] = $prefix.search_tolerances.fragment.fragment_mass_tolerance 
  #end if
#end if

#if $prefix.search_tolerances.isotope_error is not None
  #set $msfragger_dict['isotope_error'] = $prefix.search_tolerances.isotope_error
#end if
#if $prefix.search_tolerances.data_type is not None
  #set $msfragger_dict['data_type'] = $prefix.search_tolerances.data_type
#end if
#if $prefix.search_tolerances.calibrate_mass is not None
  #set $msfragger_dict['calibrate_mass'] = $prefix.search_tolerances.calibrate_mass
#end if

## digest parameters
##enzyme_1
#if $prefix.digestion.digest.search_enzyme_name is not None
  #set $msfragger_dict['search_enzyme_name_1'] = $prefix.digestion.digest.search_enzyme_name
  #set $msfragger_dict['misc.fragger.enzyme-dropdown-1'] = $prefix.digestion.digest.search_enzyme_name
#end if
#if $prefix.digestion.digest.search_enzyme_cut is not None
  #set $msfragger_dict['search_enzyme_cut_1'] = $prefix.digestion.digest.search_enzyme_cut
#end if
#if $prefix.digestion.digest.search_enzyme_nocut is not None
  #set $msfragger_dict['search_enzyme_nocut_1'] =  $prefix.digestion.digest.search_enzyme_nocut
#end if
#if $prefix.digestion.allowed_missed_cleavage is not None
  #set $msfragger_dict['allowed_missed_cleavage_1'] = $prefix.digestion.allowed_missed_cleavage
#end if
#if $prefix.digestion.search_enzyme_sense is not None
  #set $msfragger_dict['search_enzyme_sense_1'] = $prefix.digestion.search_enzyme_sense
#end if
##enzyme_2
#if $prefix.digestion.enzyme2.digest2 == 'yes'
  #if $prefix.digestion.enzyme2.digest.search_enzyme_name is not None
    #set $msfragger_dict['search_enzyme_name_2'] = $prefix.digestion.enzyme2.digest.search_enzyme_name
    #set $msfragger_dict['misc.fragger.enzyme-dropdown-2'] = $prefix.digestion.enzyme2.digest.search_enzyme_name
  #end if
  #if $prefix.digestion.enzyme2.digest.search_enzyme_cut is not None
    #set $msfragger_dict['search_enzyme_cut_2'] = $prefix.digestion.enzyme2.digest.search_enzyme_cut
  #end if
  #if $prefix.digestion.enzyme2.digest.search_enzyme_nocut is not None
    #set $msfragger_dict['search_enzyme_nocut_2'] = $prefix.digestion.enzyme2.digest.search_enzyme_nocut
  #end if
  #if $prefix.digestion.enzyme2.allowed_missed_cleavage is not None
    #set $msfragger_dict['allowed_missed_cleavage_2'] = $prefix.digestion.enzyme2.allowed_missed_cleavage
  #end if
  #if $prefix.digestion.enzyme2.search_enzyme_sense is not None
    #set $msfragger_dict['search_enzyme_sense_2'] = $prefix.digestion.enzyme2.search_enzyme_sense
  #end if
#else
  #set $msfragger_dict['search_enzyme_sense_2'] = 'C'
#end if
#if $prefix.digestion.num_enzyme_termini is not None
  #set $msfragger_dict['num_enzyme_termini'] = $prefix.digestion.num_enzyme_termini
#end if
#if $prefix.digestion.digest_min_length is not None
  #set $msfragger_dict['digest_min_length'] = $prefix.digestion.digest_min_length
#end if
#if $prefix.digestion.digest_max_length is not None
  #set $msfragger_dict['digest_max_length'] = $prefix.digestion.digest_max_length
#end if
#if $prefix.digestion.digest_mass_range_min is not None
  #set $msfragger_dict['misc.fragger.digest-mass-lo'] = $prefix.digestion.digest_mass_range_min
  ## #set $msfragger_dict['digest_mass_range'] = $prefix.digestion.digest_mass_range_min
#end if
#if $prefix.digestion.digest_mass_range_min is not None
  #set $msfragger_dict['misc.fragger.digest-mass-hi'] = $prefix.digestion.digest_mass_range_max
  ## #set $msfragger_dict['digest_mass_range'] = $prefix.digestion.digest_mass_range_max
#end if
#slurp</token>

    <token name="@DEFAULT_CONFIG@">#slurp

#slurp</token>


    <xml name="search_tolerances" token_precursor_ppm="false" token_precursor_da="false" token_precursor_mass_lower="-50" token_precursor_mass_upper="50" token_isotope_error="" token_fragment_mass_tolerance="20">
        <section name="search_tolerances" expanded="false" title="Search Tolerances">

            <conditional name="precursor">
                <param name="precursor_mass_units" type="select" label="Set Precursor Mass tolerances" help="Sets default parameters">
                    <option value="default">Use default</option>
                    <option value="ppm" selected="@PRECURSOR_PPM@">ppm</option>
                    <option value="Da" selected="@PRECURSOR_DA@">Daltons</option>
                </param>
                <when value="default"/>
                <when value="ppm">
                    <param name="precursor_mass_lower" argument="precursor_mass_lower" type="integer" value="@PRECURSOR_MASS_LOWER@" max="0" optional="true" label="Precursor mass tolerance lower bound" />
                    <param name="precursor_mass_upper" argument="precursor_mass_upper" type="integer" value="@PRECURSOR_MASS_UPPER@" min="0" optional="true" label="Precursor mass tolerance upper bound" />
                </when>
                <when value="Da">
                    <!-- Need to get correct defaults for Daltions -->
                    <param name="precursor_mass_lower" argument="precursor_mass_lower" type="float" value="@PRECURSOR_MASS_LOWER@" max="0" optional="true" label="Precursor mass tolerance lower bound" />
                    <param name="precursor_mass_upper" argument="precursor_mass_upper" type="float" value="@PRECURSOR_MASS_UPPER@" min="0" optional="true" label="Precursor mass tolerance upper bound" />
                </when>
            </conditional>

            <conditional name="precursor_true">
                <param name="precursor_true_units" type="select" label="Set Precursor True tolerance" help="STRONGLY recommended for open searches">
                    <option value="default">Use default</option>
                    <option value="ppm">ppm</option>
                    <option value="Da">Daltons</option>
                </param>
                <when value="default"/>
                <when value="ppm">
                    <param name="precursor_true_tolerance" type="integer" value="" min="1" max="100" optional="true" label="Precursor true tolerance"
                        help="True precursor mass tolerance (window is +/- this value). Used for tie breaker of results (in spectrally ambiguous cases) and zero bin boosting in open searches (0 disables these features). This option is STRONGLY recommended for open searches.  Default: 0"/>
                </when>
                <when value="Da">
                    <param name="precursor_true_tolerance" type="float" value="" min="0" max="10" optional="true" label="Precursor true tolerance"
                        help="True precursor mass tolerance (window is +/- this value). Used for tie breaker of results (in spectrally ambiguous cases) and zero bin boosting in open searches (0 disables these features). This option is STRONGLY recommended for open searches.  Default: 0"/>
                </when>
            </conditional>

            <conditional name="fragment">
                <param name="fragment_mass_units" type="select" label="Set Fragment Mass tolerances" help="Sets default parameters">
                    <option value="default">Use default</option>
                    <option value="ppm" selected="true">ppm</option>
                    <option value="Da">Daltons</option>
                </param>
                <when value="default"/>
                <when value="ppm">
                    <param name="fragment_mass_tolerance" type="integer" value="@FRAGMENT_MASS_TOLERANCE@" min="1" max="100" optional="true" label="Fragment mass tolerance"
                        help="Fragment mass tolerance (window is +/- this value) Default: 20"/>
                </when>
                <when value="Da">
                    <!-- Need to get correct defaults for Daltions -->
                    <param name="fragment_mass_tolerance" type="float" value="20" min="1" max="100" optional="true" label="Fragment mass tolerance"
                        help="Fragment mass tolerance (window is +/- this value) Default: 20"/>
                </when>
            </conditional>

            <param name="isotope_error" argument="isotope_error" type="select" value="@ISOTOPE_ERROR@" optional="true" label="Isotope error">
                <help>
Isotope correction for MS/MS events triggered on isotopic peaks. Should be set to 0 (disabled) for open search or 0/1/2 for correction of narrow window searches. Shifts the precursor mass window to multiples of this value multiplied by the mass of C13-C12.
                </help>
                <option value="0">0 - Disabled (for open search)</option>
                <option value="0/1">0/1 - (Nonspecific)</option>
                <option value="0/1/2">0/1/2 - (Correction for narrow window searches)</option>
                <option value="0/1/2/3">0/1/2/3</option>
                <option value="-1/0/1/2/3">-1/0/1/2/3</option>
            </param>
            <param name="calibrate_mass" argument="calibrate_mass" type="select" label="Calibration and Optimization">
                <option value="0">0 - None</option>
                <option value="1">1 - Mass calibration</option>
                <option value="2" selected="true">2 - Mass calibration, parameter optimization</option>
            </param>
            <param name="data_type" argument="data_type" type="select" label="Data type">
                <option value="0" selected="true">0 - DDA</option>
                <option value="1">1 - DIA</option>
                <option value="2">2 - DIA-narrow-window</option>
            </param>
        </section>
    </xml>
    
    <token name="@SEARCH_TOLERANCES@">
    </token>

    <xml name="cleavage" token_search_enzyme_name="trypsin" token_cut="KR" token_nocut="P">
            <param name="search_enzyme_name" type="text" value="@SEARCH_ENZYME_NAME@" optional="true" 
                label="Digestion Enzyme" help="Name of enzyme to be written to the pepXML file."/>
            <param name="search_enzyme_cut" type="text" value="@CUT@" optional="true" 
                label="Residues after which the enzyme cuts" help="search_enzyme_cutafter Residues after which the enzyme cuts Default: KR"/>
            <param name="search_enzyme_nocut" type="text" value="@NOCUT@" optional="true" 
                label="Residues that the enzyme will not cut before" help="search_enzyme_butnotafter - (misnomer: should really be called butnotbefore) Default: P"/>
    </xml>
    <xml name="digest" token_stricttrypsin="true" token_nonspecific="false">
            <conditional name="digest">
                <param name="search_enzyme" type="select" label="Protein Digestion Enzyme">
                    <option value="trypsin">trypsin</option>
                    <option value="stricttrypsin" selected="@STRICTTRYPSIN@">stricttrypsin</option>
                    <option value="argc">argc</option>
                    <option value="chymotrypsin">chymotrypsin</option>
                    <option value="cnbr">cnbr</option>
                    <option value="elastase">elastase</option>
                    <option value="formicacid">formicacid</option>
                    <option value="gluc">gluc</option>
                    <option value="gluc_bicarb">gluc_bicarb</option>
                    <option value="lysc">lysc</option>
                    <option value="lysc-p">lysc-p</option>
                    <option value="nonspecific" selected="@NONSPECIFIC@">nonspecific</option>
                    <option value="custom">custom</option>
                    <option value="trypsin/chymotrypsin">trypsin/chymotrypsin</option>
                    <option value="trypsin/cnbr">trypsin/cnbr</option>
                    <option value="trypsin_gluc">trypsin_gluc</option>
                    <option value="trypsin_k">trypsin_k</option>
                    <option value="trypsin_r">trypsin_r</option>
                </param>
                <when value="trypsin">
                    <expand macro="cleavage" search_enzyme_name="trypsin" cut="KR" nocut="P"/>
                </when>
                <when value="stricttrypsin">
                    <expand macro="cleavage" search_enzyme_name="stricttrypsin" cut="KR" nocut=""/>
                </when>
                <when value="argc">
                    <expand macro="cleavage" search_enzyme_name="argc" cut="R" nocut="P"/>
                </when>
                <when value="chymotrypsin">
                    <expand macro="cleavage" search_enzyme_name="chymotrypsin" cut="FLWY" nocut="P"/>
                </when>
                <when value="cnbr">
                    <expand macro="cleavage" search_enzyme_name="cnbr" cut="M" nocut=""/>
                </when>
                <when value="elastase">
                    <expand macro="cleavage" search_enzyme_name="elastase" cut="AGILV" nocut="P"/>
                </when>
                <when value="formicacid">
                    <expand macro="cleavage" search_enzyme_name="formicacid" cut="D" nocut="P"/>
                </when>
                <when value="gluc">
                    <expand macro="cleavage" search_enzyme_name="gluc" cut="DE" nocut="P"/>
                </when>
                <when value="gluc_bicarb">
                    <expand macro="cleavage" search_enzyme_name="gluc_bicarb" cut="E" nocut="P"/>
                </when>
                <when value="lysc">
                    <expand macro="cleavage" search_enzyme_name="lysc" cut="K" nocut="P"/>
                </when>
                <when value="lysc-p">
                    <expand macro="cleavage" search_enzyme_name="lysc-p" cut="K" nocut=""/>
                </when>
                <when value="nonspecific">
                    <expand macro="cleavage" search_enzyme_name="nonspecific" cut="-" nocut=""/>
                 </when>
                <when value="custom">
                    <expand macro="cleavage" search_enzyme_name="custom" cut="" nocut=""/>
                </when>
                <when value="trypsin/chymotrypsin">
                    <expand macro="cleavage" search_enzyme_name="trypsin/chymotrypsin" cut="FYWLKR" nocut="P"/>
                </when>
                <when value="trypsin/cnbr">
                    <expand macro="cleavage" search_enzyme_name="trypsin/cnbr" cut="KR" nocut="P"/>
                </when>
                <when value="trypsin_gluc">
                    <expand macro="cleavage" search_enzyme_name="trypsin_gluc" cut="DEKR" nocut="P"/>
                </when>
                <when value="trypsin_k">
                    <expand macro="cleavage" search_enzyme_name="trypsin_k" cut="K" nocut="P"/>
                </when>
                <when value="trypsin_r">
                    <expand macro="cleavage" search_enzyme_name="trypsin_r" cut="R" nocut="P"/>
                </when>
            </conditional>
            <param name="allowed_missed_cleavage" type="integer" value="2" min="0" max="5" optional="true" 
                label="Allowed number of missed cleavages"/>
            <param name="search_enzyme_sense" type="select" label="Protein Digestion Enzyme">
                <option value="C">C</option>
                <option value="N">N</option>
            </param>
    </xml>

    <xml name="digestion" token_stricttrypsin="true" token_nonspecific="false" token_digest_max_length="50" token_termini_0="false" token_termini_1="false" token_termini_2="true">
        <section name="digestion" expanded="false" title="In-silico Digestion Parameters">
            <expand macro="digest" stricttrypsin="@STRICTTRYPSIN@" nonspecific="@NONSPECIFIC@"/>
            <conditional name="enzyme2">
                <param name="digest2" type="select" label="Second Enzyme Digest">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </param>
                <when value="no"/>
                <when value="yes">
                    <expand macro="digest" stricttrypsin="false" nonspecific="false"/>
                </when>
            </conditional>
            <param name="num_enzyme_termini" type="select" label="Number of enzyme termini">
                <option value="0" selected="@TERMINI_0@">0 - non-enzymatic</option>
                <option value="1" selected="@TERMINI_1@">1 - semi-enzymatic</option>
                <option value="2" selected="@TERMINI_2@">2 - fully-enzymatic</option>
            </param>
            <param name="digest_min_length" type="integer" value="7" min="1" max="30" optional="true" 
                label="Minimum length of peptides to be generated during in-silico digestion"/>
            <param name="digest_max_length" type="integer" value="@DIGEST_MAX_LENGTH@" min="10" max="100" optional="true" 
                label="Maximum length of peptides to be generated during in-silico digestion"/>
            <param name="digest_mass_range_min" type="float" value="500.0" min="0.0" optional="true" 
                label="Minimum Mass of peptides to be generated during in-silico digestion in Daltons" />
            <param name="digest_mass_range_max" type="float" value="5000.0" min="0.0" optional="true" 
                label="Maximum Mass of peptides to be generated during in-silico digestion in Daltons" />
        </section>
    </xml>
    <token name="@DIGESTION@">
    </token>

    <xml name="variable_modifications">
        <option value="15.99491461956 M 3">Oxidation of M (15.99491461956) modaa</option>
        <option value="42.0105646837 [^ 1">Acetylation of peptide N-term (42.0105646837) modn_peptide</option>
        <option value="79.96633052074999 STY 3">Phosphorylation of STY (79.96633052074999) modaa</option>
        <option value="229.16293213472 n^ 1">TMT 10-plex of peptide N-term (229.16293213472) modn_peptide</option>
        <option value="229.16293213472 S 1">TMT of S (229.16293213472) modaa</option>
        <option value="-18.0105646837 nE 1">Pyrolidone from E (-18.0105646837) modnaa_peptide</option>
    </xml>

    <token name="@RE_FLOAT@">[+-]?\d+(\.\d*)?</token>
    <token name="@RE_AA@">([A-Z]+|(c[A-Z*])+|(n[A-Z*])+|\[^|\]^)</token>
    <token name="@RE_MOD@">@RE_FLOAT@,@RE_AA@,\d</token>
    <token name="@RE_MODS@">@RE_MOD@(;\s*@RE_MOD@)*</token>
    <xml name="variable_modification" token_max_variable_mods_per_peptide="3">
        <section name="variable_modification" expanded="false" title="Variable Modifications">
            <param name="max_variable_mods_per_peptide" type="integer" value="@MAX_VARIABLE_MODS_PER_PEPTIDE@" min="0" max="5" optional="true" 
                label="Maximum total number of variable modifications per peptide"/>
            <param name="variable_mods_select" type="select" optional="true" multiple="true" label="Select Variable Modifications">
                <expand macro="variable_modifications"/>
                <!--
                <sanitizer invalid_char="">
                    <valid initial="string.printable">
                    </valid>
                </sanitizer>
                -->
            </param>
            <param name="variable_mods" type="text" area="True" size="120x7" value="" optional="true" 
                label="Enter Variable Modifications">
                <help><![CDATA[
Separate variable modifications with semicolons. Each modification has mass_change, residues, and max occurances values separated by commas. 
* is used to represent any amino acid 
[ is a modifier for protein N-terminal
] is a modifier for protein C-terminal
n is a modifier for peptide N-terminal 
c is a modifier for peptide C-terminal
Syntax Examples:
15.9949,M,3 (for oxidation on methionine)
79.66331,STY,1 (for phosphorylation)
-17.0265,nQnC,1 (for pyro-Glu or loss of ammonia at peptide N-terminal)
Example (M oxidation and N-terminal acetylation):
15.9949,M,3;42.0106,[*,1
                ]]></help>
                <!-- regex working in python, but not webform -->
                <!--
                <validator type="regex">^\s*@RE_MODS@\s*$</validator>
                -->
                <sanitizer sanitize="False"/>
            </param>

            <param name="use_all_mods_in_first_search" type="select" optional="true" label="Use all variable modifications in first search">
                <option value="true">Yes</option>
                <option value="false">No</option>
            </param>
            <param name="clip_nTerm_M" type="select" optional="true" label="Trim protein N-terminal methionine as a variable modification">
                <option value="true">Yes</option>
                <option value="false">No</option>
            </param>
            <param name="allow_multiple_variable_mods_on_residue" type="select" optional="true" label="Allow each amino acid to be modified by multiple variable modifications">
                <option value="true">Yes</option>
                <option value="false">No</option>
            </param>

            <param name="max_variable_mods_per_mod" type="integer" value="2" min="0" max="5" optional="true" 
                label="Maximum number of residues that can be occupied by each variable modification"/>
            <param name="max_variable_mods_combinations" type="integer" value="5000" min="0" max="65534" optional="true" 
                label="Maximum allowed number of modified variably modified peptides from each peptide sequence"
                help="If a greater number than the maximum is generated, only the unmodified peptide is considered."/>
        </section>
    </xml>
    <token name="@VARIABLE_MODIFICATION@">#slurp
## Variable Modification Parameters
#if $prefix.variable_modification.clip_nTerm_M
  #set $msfragger_dict['clip_nTerm_M'] = $prefix.variable_modification.clip_nTerm_M
#end if
#if $prefix.variable_modification.max_variable_mods_per_peptide
  #set $msfragger_dict['max_variable_mods_per_peptide'] = $prefix.variable_modification.max_variable_mods_per_peptide
#end if
##maximum of 7 mods - amino acid codes, * for any amino acid, [ and ] specifies protein termini, n and c specifies peptide termini
##variable_mod_01=15.9949 M
##variable_mod_02=42.0106 [*
##variable_mod_03=79.96633 STY
##variable_mod_03=-17.0265 nQnC
##variable_mod_04=-18.0106 nE
##
#if $prefix.variable_modification.use_all_mods_in_first_search
  #set $msfragger_dict['use_all_mods_in_first_search'] = $prefix.variable_modification.use_all_mods_in_first_search
#end if
#if $prefix.variable_modification.allow_multiple_variable_mods_on_residue
  #set $msfragger_dict['allow_multiple_variable_mods_on_residue'] = $prefix.variable_modification.allow_multiple_variable_mods_on_residue
#end if
#if $prefix.variable_modification.max_variable_mods_per_mod is not None
  #set $msfragger_dict['max_variable_mods_per_mod'] = $prefix.variable_modification.max_variable_mods_per_mod
#end if
#if $prefix.variable_modification.max_variable_mods_combinations is not None
  #set $msfragger_dict['max_variable_mods_combinations'] = $prefix.variable_modification.max_variable_mods_combinations
#end if
#set $vmods =[]
#if $prefix.variable_modification.variable_mods_select
  ## $prefix.variable_modification.variable_mods_select
  #set $vmods = [x.replace(' ',',') for x in str($prefix.variable_modification.variable_mods_select).split(',')]
#end if
#if $prefix.variable_modification.variable_mods
  ## $prefix.variable_modification.variable_mods
  #set $vmods += [x.strip() for x in str($prefix.variable_modification.variable_mods).split(';')]
#end if
#slurp</token>

    <xml name="static_modification">
        <section name="static_modification" expanded="false" title="Static Modifications">
            <param name="add_Cterm_peptide" type="float" value="" optional="true" 
                label="Statically add mass in Da to C-terminal of peptide Default: 0.0" />
            <param name="add_Nterm_peptide" type="float" value="" optional="true" 
                label="Statically add mass in Da to N-terminal of peptide Default: 0.0" />
            <param name="add_Cterm_protein" type="float" value="" optional="true" 
                label="Statically add mass in Da to C-terminal of protein Default: 0.0" />
            <param name="add_Nterm_protein" type="float" value="" optional="true" 
                label="Statically add mass in Da to N-terminal of protein Default: 0.0" />
            <param name="add_A_alanine" type="float" value="" optional="true"
                label="Statically add mass in Da to A (alanine) Default: 0.0" />
            <param name="add_R_arginine" type="float" value="" optional="true"
                label="Statically add mass in Da to R (arginine) Default: 0.0" />
            <param name="add_N_asparagine" type="float" value="" optional="true"
                label="Statically add mass in Da to N (asparagine) Default: 0.0" />
            <param name="add_D_aspartic_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to D (aspartic_acid) Default: 0.0" />
            <param name="add_C_cysteine" type="float" value="" optional="true"
                label="Statically add mass in Da to C (cysteine) Default: 0.0" />
            <param name="add_E_glutamic_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to E (glutamic_acid) Default: 0.0" />
            <param name="add_Q_glutamine" type="float" value="" optional="true"
                label="Statically add mass in Da to Q (glutamine) Default: 0.0" />
            <param name="add_G_glycine" type="float" value="" optional="true"
                label="Statically add mass in Da to G (glycine) Default: 0.0" />
            <param name="add_H_histidine" type="float" value="" optional="true"
                label="Statically add mass in Da to H (histidine) Default: 0.0" />
            <param name="add_I_isoleucine" type="float" value="" optional="true"
                label="Statically add mass in Da to I (isoleucine) Default: 0.0" />
            <param name="add_L_leucine" type="float" value="" optional="true"
                label="Statically add mass in Da to L (leucine) Default: 0.0" />
            <param name="add_K_lysine" type="float" value="" optional="true"
                label="Statically add mass in Da to K (lysine) Default: 0.0" />
            <param name="add_M_methionine" type="float" value="" optional="true"
                label="Statically add mass in Da to M (methionine) Default: 0.0" />
            <param name="add_F_phenylalanine" type="float" value="" optional="true"
                label="Statically add mass in Da to F (phenylalanine) Default: 0.0" />
            <param name="add_P_proline" type="float" value="" optional="true"
                label="Statically add mass in Da to P (proline) Default: 0.0" />
            <param name="add_S_serine" type="float" value="" optional="true"
                label="Statically add mass in Da to S (serine) Default: 0.0" />
            <param name="add_T_threonine" type="float" value="" optional="true"
                label="Statically add mass in Da to T (threonine) Default: 0.0" />
            <param name="add_W_tryptophan" type="float" value="" optional="true"
                label="Statically add mass in Da to W (tryptophan) Default: 0.0" />
            <param name="add_Y_tyrosine" type="float" value="" optional="true"
                label="Statically add mass in Da to Y (tyrosine) Default: 0.0" />
            <param name="add_V_valine" type="float" value="" optional="true"
                label="Statically add mass in Da to V (valine) Default: 0.0" />
            <param name="add_B_user_amino_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to B (iuser_amino_acid) Default: 0.0" />
            <param name="add_J_user_amino_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to J (iuser_amino_acid) Default: 0.0" />
            <param name="add_O_user_amino_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to O (user_amino_acid) Default: 0.0" />
            <param name="add_U_user_amino_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to U (iuser_amino_acid) Default: 0.0" />
            <param name="add_X_user_amino_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to X (iuser_amino_acid) Default: 0.0" />
            <param name="add_Z_user_amino_acid" type="float" value="" optional="true"
                label="Statically add mass in Da to Z (iuser_amino_acid) Default: 0.0" />
        </section>
    </xml>
    <token name="@STATIC_MODIFICATION@">#slurp
#set $fmods = {}
#if $prefix.static_modification.add_Cterm_peptide is not None
  #set $fmods['Cterm_peptide'] = $prefix.static_modification.add_Cterm_peptide
#end if
#if $prefix.static_modification.add_Nterm_peptide is not None
  #set $fmods['Nterm_peptide'] = $prefix.static_modification.add_Nterm_peptide
#end if
#if $prefix.static_modification.add_Cterm_protein is not None
  #set $fmods['Cterm_protein'] = $prefix.static_modification.add_Cterm_protein
#end if
#if $prefix.static_modification.add_Nterm_protein is not None
  #set $fmods['Nterm_protein'] = $prefix.static_modification.add_Nterm_protein
#end if
#if $prefix.static_modification.add_G_glycine is not None
  #set $fmods['G_glycine'] = $prefix.static_modification.add_G_glycine
#end if
#if $prefix.static_modification.add_A_alanine is not None
  #set $fmods['A_alanine'] = $prefix.static_modification.add_A_alanine
#end if
#if $prefix.static_modification.add_S_serine is not None
  #set $fmods['S_serine'] = $prefix.static_modification.add_S_serine
#end if
#if $prefix.static_modification.add_P_proline is not None
  #set $fmods['P_proline'] = $prefix.static_modification.add_P_proline
#end if
#if $prefix.static_modification.add_V_valine is not None
  #set $fmods['V_valine'] = $prefix.static_modification.add_V_valine
#end if
#if $prefix.static_modification.add_T_threonine is not None
  #set $fmods['T_threonine'] = $prefix.static_modification.add_T_threonine
#end if
#if $prefix.static_modification.add_C_cysteine is not None
  #set $fmods['C_cysteine'] = $prefix.static_modification.add_C_cysteine
#end if
#if $prefix.static_modification.add_L_leucine is not None
  #set $fmods['L_leucine'] = $prefix.static_modification.add_L_leucine
#end if
#if $prefix.static_modification.add_I_isoleucine is not None
  #set $fmods['I_isoleucine'] = $prefix.static_modification.add_I_isoleucine
#end if
#if $prefix.static_modification.add_N_asparagine is not None
  #set $fmods['N_asparagine'] = $prefix.static_modification.add_N_asparagine
#end if
#if $prefix.static_modification.add_D_aspartic_acid is not None
  #set $fmods['D_aspartic_acid'] = $prefix.static_modification.add_D_aspartic_acid
#end if
#if $prefix.static_modification.add_Q_glutamine is not None
  #set $fmods['Q_glutamine'] = $prefix.static_modification.add_Q_glutamine
#end if
#if $prefix.static_modification.add_K_lysine is not None
  #set $fmods['K_lysine'] = $prefix.static_modification.add_K_lysine
#end if
#if $prefix.static_modification.add_E_glutamic_acid is not None
  #set $fmods['E_glutamic_acid'] = $prefix.static_modification.add_E_glutamic_acid
#end if
#if $prefix.static_modification.add_M_methionine is not None
  #set $fmods['M_methionine'] = $prefix.static_modification.add_M_methionine
#end if
#if $prefix.static_modification.add_H_histidine is not None
  #set $fmods['H_histidine'] = $prefix.static_modification.add_H_histidine
#end if
#if $prefix.static_modification.add_F_phenylalanine is not None
  #set $fmods['F_phenylalanine'] = $prefix.static_modification.add_F_phenylalanine
#end if
#if $prefix.static_modification.add_R_arginine is not None
  #set $fmods['R_arginine'] = $prefix.static_modification.add_R_arginine
#end if
#if $prefix.static_modification.add_Y_tyrosine is not None
  #set $fmods['Y_tyrosine'] = $prefix.static_modification.add_Y_tyrosine
#end if
#if $prefix.static_modification.add_W_tryptophan is not None
  #set $fmods['W_tryptophan'] = $prefix.static_modification.add_W_tryptophan
#end if
#*
#if $prefix.static_modification.add_B_user_amino_acid is not None
  #set $fmods['B_user_amino_acid'] = $prefix.static_modification.add_B_user_amino_acid
#end if
#if $prefix.static_modification.add_J_user_amino_acid is not None
  #set $fmods['J_user_amino_acid'] = $prefix.static_modification.add_J_user_amino_acid
#end if
#if $prefix.static_modification.add_O_user_amino_acid is not None
  #set $fmods['O_user_amino_acid'] = $prefix.static_modification.add_O_user_amino_acid
#end if
#if $prefix.static_modification.add_U_user_amino_acid is not None
  #set $fmods['U_user_amino_acid'] = $prefix.static_modification.add_U_user_amino_acid
#end if
#if $prefix.static_modification.add_X_user_amino_acid is not None
  #set $fmods['X_user_amino_acid'] = $prefix.static_modification.add_X_user_amino_acid
#end if
#if $prefix.static_modification.add_Z_user_amino_acid is not None
  #set $fmods['Z_user_amino_acid'] = $prefix.static_modification.add_Z_user_amino_acid
#end if
*#
#slurp</token>

    <xml name="spectrum_processing" token_mode_selected="false" token_mode_isolated="false" token_mode_corrected="false" token_override_charge="false" token_rm_peak0="false" token_rm_peak1="false" token_rm_peak2="false">
        <section name="spectrum_processing" expanded="false" title="Spectrum Processing">
            <param name="precursor_mass_mode" type="select" optional="true" label="Precursor mass mode">
                <option value="isolated" selected="@MODE_ISOLATED@">isolated</option>
                <option value="selected" selected="@MODE_SELECTED@">selected</option>
                <option value="corrected" selected="@MODE_CORRECTED@">corrected</option>
            </param>
            <param name="minimum_peaks" type="integer" value="" min="0" optional="true" 
                label="Minimum number of peaks in experimental spectrum for matching" />
            <param name="use_topN_peaks" type="integer" value="" min="0" optional="true" 
                label="Pre-process experimental spectrum to only use top N peaks" />
            <param name="minimum_ratio" type="float" value="" min="0.0" optional="true"
                label="Filter peaks by minimum_ratio of base peak"
                help="Filters out all peaks in experimental spectrum less intense than this multiple of the base peak intensit Default: 0.0" />
            <conditional name="precursor">
                <param name="override_charge" type="select" label="Precursor Charge Override" help="override_charge">
                    <option value="default">Use default</option>
                    <option value="false">Use precursor charge</option>
                    <option value="true" selected="@OVERRIDE_CHARGE@">Ignore precursor charge and set range</option>
                </param>
                <when value="default"/>
                <when value="false"/>
                <when value="true">
                    <param name="precursor_charge_min" type="integer" value="1" min="0" max="6"
                        label="Minimum Potential Precursor Charge" />
                    <param name="precursor_charge_max" type="integer" value="4" min="0" max="8"
                        label="Maximum Potential Precursor Charge" />
                </when>
            </conditional>
            <section name="clear" expanded="false" title="Clear mz range for iTRAQ/TMT experiments">
                <param name="clear_mz_range_min" type="float" value="0.0" min="0.0" optional="true" label="Minimum of m/z range to remove" />
                <param name="clear_mz_range_max" type="float" value="0.0" min="0.0" optional="true" label="Maximum of m/z range to remove" />
            </section>
            <param name="remove_precursor_peak" type="select" optional="true" label="Remove precursor peak">
                <option value="0" selected="@RM_PEAK0@">do not remove</option>
                <option value="1" selected="@RM_PEAK1@">remove the peak with precursor charge</option>
                <option value="2" selected="@RM_PEAK2@">remove the peaks with all charge states (only for DDA mode)</option>
            </param>
            <param name="remove_precursor_range_min" type="float" value="-1.5" min="-10.0" max="0.0" optional="true" label="Minimum of precursor m/z range to remove" />
            <param name="remove_precursor_range_max" type="float" value="1.5" min="0.0" max="10.0" optional="true" label="Maximum of precursor m/z range to remove" />
            <param name="intensity_transform" type="select" optional="true" label="Intensity transform">
                <option value="0" selected="true">None not remove</option>
                <option value="1">Square root</option>
            </param>
            <param name="check_spectral_files" type="boolean" truevalue="true" falsevalue="false" checked="true" label="Check spectral files"/>
            <param name="activation_types" type="select" optional="true" label="Activation Type Filter">
                <option value="all" selected="true">all</option>
                <option value="HCD">HCD</option>
                <option value="ETD">ETD</option>
                <option value="CID">CID</option>
                <option value="ECD">ECD</option>
            </param>
        </section>
    </xml>
    <token name="@SPECTRUM_PROCESSING@">#slurp
## spectral processing
#if $prefix.spectrum_processing.precursor_mass_mode
  #set $msfragger_dict['precursor_mass_mode'] = $prefix.spectrum_processing.precursor_mass_mode
#end if
#if str($prefix.spectrum_processing.minimum_peaks).strip()
  #set $msfragger_dict['minimum_peaks'] = $prefix.spectrum_processing.minimum_peaks
#end if
#if str($prefix.spectrum_processing.use_topN_peaks).strip()
  #set $msfragger_dict['use_topN_peaks'] = $prefix.spectrum_processing.use_topN_peaks
#end if
#if str($prefix.spectrum_processing.minimum_ratio).strip()
  #set $msfragger_dict['minimum_ratio'] = $prefix.spectrum_processing.minimum_ratio
#end if
#if $prefix.spectrum_processing.precursor.override_charge != 'default'
  #set $msfragger_dict['override_charge'] = $prefix.spectrum_processing.precursor.override_charge
#end if
#if $prefix.spectrum_processing.precursor.override_charge == 'true'
  #if $prefix.spectrum_processing.precursor.precursor_charge_min is not None
    #set $msfragger_dict['misc.fragger.precursor-charge-lo'] = $prefix.spectrum_processing.precursor.precursor_charge_min
  #end if
  #if $prefix.spectrum_processing.precursor.precursor_charge_max is not None
    #set $msfragger_dict['misc.fragger.precursor-charge-hi'] = $prefix.spectrum_processing.precursor.precursor_charge_max
  #end if
#end if
#if $prefix.spectrum_processing.clear.clear_mz_range_min is not None 
  #set $msfragger_dict['misc.fragger.clear-mz-lo'] = $prefix.spectrum_processing.clear.clear_mz_range_min
#end if
#if $prefix.spectrum_processing.clear.clear_mz_range_max is not None
  #set $msfragger_dict['misc.fragger.clear-mz-hi'] = $prefix.spectrum_processing.clear.clear_mz_range_max
#end if
#if $prefix.spectrum_processing.remove_precursor_peak
  #set $msfragger_dict['remove_precursor_peak'] = $prefix.spectrum_processing.remove_precursor_peak
#end if
#if $prefix.spectrum_processing.remove_precursor_range_min is not None
  #set $msfragger_dict['misc.fragger.remove-precursor-range-lo'] = $prefix.spectrum_processing.remove_precursor_range_min
#end if 
#if $prefix.spectrum_processing.remove_precursor_range_max is not None
  #set $msfragger_dict['misc.fragger.remove-precursor-range-hi'] = $prefix.spectrum_processing.remove_precursor_range_max
#end if 

#if $prefix.spectrum_processing.intensity_transform is not None
  #set $msfragger_dict['intensity_transform'] = $prefix.spectrum_processing.intensity_transform
#end if

#if $prefix.spectrum_processing.check_spectral_files is not None
  #set $msfragger_dict['check_spectral_files'] = $prefix.spectrum_processing.check_spectral_files
#end if

#if $prefix.spectrum_processing.activation_types is not None
  #set $msfragger_dict['activation_types'] = $prefix.spectrum_processing.activation_types
#end if
#slurp</token>

    <xml name="open_search_options" token_localize="false" token_mass_diff_to_variable_mod0="true" token_mass_diff_to_variable_mod1="false" token_mass_diff_to_variable_mod2="false">
        <section name="open_search" expanded="false" title="Open Search Options">
            <param name="mass_diff_to_variable_mod" type="select" label="Report mass shift as a variable mod">
                <option value="0" selected="@MASS_DIFF_TO_VARIABLE_MOD0@">0 - No</option>
                <option value="1" selected="@MASS_DIFF_TO_VARIABLE_MOD1@">1 - yes and remove delta mass</option>
                <option value="2" selected="@MASS_DIFF_TO_VARIABLE_MOD2@">2 - yes and keep delta mass</option>
            </param>
            <param name="track_zero_topN" type="integer" value="" min="0" optional="true" 
                label="Track top N unmodified peptide results" >
                <help>
                    Track top N unmodified peptide results separately from main results internally for boosting features. 
                    Should be set to a number greater than output_report_topN if zero bin boosting is desired.
                    Default: 0
                </help>
            </param>
            <param name="zero_bin_accept_expect" type="float" value="" min="0.0" optional="true"
                label="Ranks a zero-bin hit above all non-zero-bin hit if it has expectation less than this value."
                help="Default: 0.0" />
            <param name="zero_bin_mult_expect" type="float" value="" min="0.0" optional="true"
                label="Multiplies expect value of PSMs in the zero-bin during results ordering"
                help="(set to less than 1 for boosting) Default: 1.0" />
            <param name="add_topN_complementary" type="integer" value="" min="0" optional="true" 
                label="Insert complementary ions corresponding to the top N most intense fragments in each experimental spectra." >
                <help>
                    Useful for recovery of modified peptides near C-terminal in open search. 
                    Should be set to 0 (disabled) otherwise.
                    Default: 0
                </help>
            </param>
            <param name="delta_mass_exclude_ranges_min" type="float" value="-1.5" label="Delta mass exclude range minimum" />
            <param name="delta_mass_exclude_ranges_max" type="float" value="3.5" label="Delta mass exclude range maximum" />
            <param name="localize_delta_mass" type="boolean" truevalue="true" falsevalue="false" checked="@LOCALIZE@" 
                 label="Localize mass shift (LOS)"/>
        </section>
    </xml>
    <token name="@OPEN_SEARCH@">#slurp
##open search parameters
#if $prefix.open_search.mass_diff_to_variable_mod is not None
  #set $msfragger_dict['mass_diff_to_variable_mod'] = $prefix.open_search.mass_diff_to_variable_mod
#end if
#if str($prefix.open_search.track_zero_topN).strip()
  #set $msfragger_dict['track_zero_topN'] = $prefix.open_search.track_zero_topN
#end if
#if str($prefix.open_search.zero_bin_accept_expect).strip()
  #set $msfragger_dict['zero_bin_accept_expect'] = $prefix.open_search.zero_bin_accept_expect
#end if
#if str($prefix.open_search.zero_bin_mult_expect).strip()
  #set $msfragger_dict['zero_bin_mult_expect'] = $prefix.open_search.zero_bin_mult_expect
#end if
#if str($prefix.open_search.add_topN_complementary).strip()
  #set $msfragger_dict['add_topN_complementary'] = $prefix.open_search.add_topN_complementary
#end if
#if $prefix.open_search.localize_delta_mass is not None
  #set $msfragger_dict['localize_delta_mass'] = $prefix.open_search.localize_delta_mass
#end if
## TEST THIS
#set $msfragger_dict['delta_mass_exclude_ranges'] = '(' + ','.join([str($prefix.open_search.delta_mass_exclude_ranges_min),str($prefix.open_search.delta_mass_exclude_ranges_max)]) + ')'
#slurp</token>

    <xml name="modeling_output">
        <section name="modeling_output" expanded="false" title="Modeling and Output">
            <param name="output_report_topN" type="integer" value="1" min="1" optional="true" 
                label="Reports top N PSMs per input spectrum  Default:1" />
            <param name="report_alternative_proteins" type="boolean" truevalue="1" falsevalue="0" checked="false" 
                 label="Report alternative proteins"/>
            <param name="output_max_expect" type="float" value="50.0" min="0.0" optional="true"
                label="Suppresses reporting of PSM if top hit has expectation greater than this threshold" />

            <param name="min_fragments_modelling" type="integer" value="3" min="1" optional="true" 
                label="Minimum number of matched peaks in PSM for inclusion in statistical modeling Default:3" />
            <param name="min_matched_fragments" type="integer" value="4" min="1" optional="true" 
                label="Minimum number of matched peaks for PSM to be reported Default:3" 
                help="recommend a minimum of 4 for narrow window searching and 6 for open searches"/>
            <param name="max_fragment_charge" type="integer" value="2" min="1" max="4" optional="true" 
                label="Maximum fragment_charge Default:2" 
                help="recommend a minimum of 4 for narrow window searching and 6 for open searches"/>
            <param name="deisotope" type="select" label="Deisotope">
                <option value="0">0 - No</option>
                <option value="1" selected="true">1 - yes and assume singleton peaks single charged</option>
                <option value="2">2 - yes and assume singleton peaks single or double charged</option>
            </param>
            <param name="deneutralloss" type="boolean" truevalue="1" falsevalue="0" checked="false" 
                 label="Perform deneutrallossing"/>
            <param name="fragment_ion_series" type="text" value="b,y" label="Fragment ion_series">
                <option value="b,y">b,y</option>
                <option value="b,y,Y">b,y,Y</option>
                <option value="b,y,c,z">b,y,c,z</option>
                <option value="b,y,c,z,Y">b,y,c,z,Y</option>
                <option value="b,y,b~,y~,Y">b,y,b~,y~,Y</option>
            </param>
        </section>
    </xml>
    <token name="@MODELING_OUTPUT@">#slurp
#* TODO
#if $prefix.modeling_output.output_report_topN is not None
  #set $msfragger_dict['output_report_topN'] = $prefix.modeling_output.output_report_topN
#end if
#if $prefix.modeling_output.report_alternative_proteins is not None
  #set $msfragger_dict['report_alternative_proteins'] = $prefix.modeling_output.report_alternative_proteins
#end if
#if prefix.modeling_output.output_max_expect is not None
  #set $msfragger_dict['output_max_expect'] = $prefix.modeling_output.output_max_expect
#end if
##Peak matching
#if $prefix.modeling_output.min_fragments_modelling is not None
  #set $msfragger_dict['min_fragments_modelling'] = $prefix.modeling_output.min_fragments_modelling
#end if
#if $prefix.modeling_output.min_matched_fragments is not None
  #set $msfragger_dict['min_matched_fragments'] = $prefix.modeling_output.min_matched_fragments
#end if
#if $prefix.modeling_output.max_fragment_charge is not None
  #set $msfragger_dict['max_fragment_charge'] = $prefix.modeling_output.max_fragment_charge
#end if
#set $msfragger_dict['deisotope'] = $prefix.modeling_output.deisotope
#set $msfragger_dict['deneutralloss'] = $prefix.modeling_output.deneutralloss
#set $msfragger_dict['fragment_ion_series'] = $prefix.modeling_output.fragment_ion_series
*#
#slurp</token>
<!-- Parameter 'ion_series_definitions' was not supplied. Using default value: -->
    <xml name="mass_offsets" token_mass_offsets="0" token_restrict_deltamass="all">
        <section name="mass_offsets" expanded="false" title="Mass Offsets">
            <param name="mass_offsets" type="text" value="@MASS_OFFSETS@" label="Mass Offsets">
                <option value="105.0248 -89.0299 -33.9877 -32.0085 -30.0106 -18.0106 -17.0265 -2.0157 -1.007825 -0.984 0 0.984 3.9949 12.0 13.9793 14.0157 15.9949 19.9898 21.969392 21.9819 23.95806 26.0157 27.9949 28.0313 28.990164 29.9742 31.972071 31.9898 37.9469 37.955882 42.0106 42.047 43.0058 43.9898 44.985078 47.9847 53.9193 57.0215 58.0055 61.9135 61.921774 68.026215 70.041865 71.0371 79.9568 79.9663 86.000394 100.016 114.042927 119.004099 128.095 146.0579 156.1011 162.0528 173.051 176.0321 178.0477 183.035399 189.046 203.0794 204.1878 210.1984 228.111 229.014009 238.2297 301.9865 340.1006 349.1373 365.1322 365.1322 406.1587 541.06111">Mass-Offset-CommonPTMs</option>
                <option value="0/541.06111">Labile_ADP-ribosylation: 0/541.06111</option>
                <option value="0/79.966331">Labile_phospho: 0/79.966331</option>
            </param>
            <param name="restrict_deltamass_to" type="text" value="@RESTRICT_DELTAMASS@" label="Restrict deltamass to">
                <option value="STY">Labile_phospho: STY</option>
                <option value="ST-">glyco-O: ST-</option>
                <option value="SKREDTY">Labile_ADP-ribosylation: SKREDTY</option>
            </param>
        </section>
    </xml>
    <token name="@MASS_OFFSETS@">#slurp
#set $msfragger_dict['mass_offsets'] = $prefix.mass_offsets.mass_offsets
#set $msfragger_dict['restrict_deltamass_to'] = $prefix.mass_offsets.restrict_deltamass_to
#slurp</token>

    <xml name="glyco_labile" token_diagnostic_intensity="0.0">
        <section name="glyco_labile" expanded="false" title="Glyco/Labile Mods">
            <param name="labile_search_mode" type="select" label="Labile modification search mode">
                <option value="off">off</option>
                <option value="nglycan">nglycan</option>
                <option value="labile">labile</option>
            </param>
            <param name="diagnostic_intensity_filter" type="float" value="@DIAGNOSTIC_INTENSITY@" min="0.0" 
                label="Suppresses reporting of PSM if top hit has expectation greater than this threshold" />
            <param name="Y_type_masses" type="text" value="" label="Y ion masses">
                <option value="@Y_TYPE_MASSES_LABILE_ADP-RIBOSYLATION@">Labile_ADP-ribosylation</option>
                <option value="@Y_TYPE_MASSES_MASS-OFFSET-COMMONPTMS@">Mass-Offset-CommonPTMs</option>
                <option value="@Y_TYPE_MASSES_GLYCO-N-HCD@">glyco-N-HCD</option>
                <option value="@Y_TYPE_MASSES_GLYCO-N-HYBRID@">glyco-N-Hybrid</option>
                <option value="@Y_TYPE_MASSES_GLYCO-N-LFQ@">glyco-N-LFQ</option>
                <option value="@Y_TYPE_MASSES_GLYCO-N-TMT@">glyco-N-TMT</option>
                <option value="@Y_TYPE_MASSES_GLYCO-N-OPEN-HCD@">glyco-N-open-HCD</option>
                <option value="@Y_TYPE_MASSES_GLYCO-N-OPEN-HYBRID@">glyco-N-open-Hybrid</option>
                <option value="@Y_TYPE_MASSES_GLYCO-O-HCD@">glyco-O-HCD</option>
                <option value="@Y_TYPE_MASSES_GLYCO-O-HYBRID@">glyco-O-Hybrid</option>
                <option value="@Y_TYPE_MASSES_GLYCO-O-OPEN-HCD@">glyco-O-open-HCD</option>
                <option value="@Y_TYPE_MASSES_GLYCO-O-OPEN-HYBRID@">glyco-O-open-Hybrid</option>
                <option value="@Y_TYPE_MASSES_ISODTB@">isoDTB</option>
            </param>
            <param name="diagnostic_fragments" type="text" value="" label="Diagnostic fragment masses">
                <option value="136.06232/250.09401/348.07036/428.03669/584.09018">Labile_ADP-ribosylation: 136.06232/250.09401/348.07036/428.03669/584.09018</option>
            </param>
            <param name="remainder_fragment_masses" type="text" value="" label="Remainder fragment masses"/>
        </section>
    </xml>
    <token name="@GLYCO_LABILE@">#slurp
#set $msfragger_dict['labile_search_mode'] = $prefix.glyco_labile.labile_search_mode
#if $prefix.glyco_labile.labile_search_mode != 'off'
  #set $msfragger_dict['diagnostic_intensity_filter'] = $prefix.glyco_labile.diagnostic_intensity_filter
  #set $msfragger_dict['diagnostic_fragments'] = $prefix.glyco_labile.diagnostic_fragments
  #set $msfragger_dict['remainder_fragment_masses'] = $prefix.glyco_labile.remainder_fragment_masses
  #set $msfragger_dict['Y_type_masses'] = $prefix.glyco_labile.Y_type_masses
#end if
#slurp</token>

    <xml name="output_format">
        <param name="output_format" type="select" multiple="true" label="output format">
            <option value="tsv" selected="true">Tabular</option>
            <option value="pepxml" selected="true">pepXML</option>
            <option value="pin">pin</option>
            <option value="mgf">calibrated mgf</option>
            <!-- only for input thermo raw and bruker d formats
            -->
        </param>
    </xml>
    <token name="@OUTPUT_FORMAT@">
#if 'mgf' in $output_format:
write_calibrated_mgf = 1
#end if
output_file_extension = pepXML
output_format = $output_format.__str__.replace(',mgf','').replace(',','_')
    </token>

    <token name="@FRAGGER_PARAMS@">#slurp
#import re
${indent}decoy_prefix${op} $decoy_prefix
@DEFAULT_CONFIG@
## Variable Modification Parameters
@VARIABLE_MODIFICATION@
@GLYCO_LABILE@
@MASS_OFFSETS@
@SPECTRUM_PROCESSING@
@OPEN_SEARCH@
@MODELING_OUTPUT@
@STATIC_MODIFICATION@
#slurp</token>

    <token name="@MSFRAGGER_PARAM_DICT@">#slurp
#import re
#set $msfragger_dict = {}
@DEFAULT_DICT@
## Variable Modification Parameters sets $vmods
@VARIABLE_MODIFICATION@
## Static Modification Parameters sets $fmods
@STATIC_MODIFICATION@
#*
*#
@GLYCO_LABILE@
@MASS_OFFSETS@
@SPECTRUM_PROCESSING@
@OPEN_SEARCH@
@MODELING_OUTPUT@
#slurp</token>

    <token name="@MSFRAGGER_PARAMS@">
#set $prefix = $cfg
#if $prefix.default_config != 'history'
#set $indent = ''
#set $op = ' ='
@FRAGGER_PARAMS@
#end if
@OUTPUT_FORMAT@
    </token>

    <token name="@PARAMS_CMD@"> <![CDATA[
#set $param_file = 'fragger.params'
echo "database_name = $db_name" > $param_file &&
#if $cfg.default_config == 'history':
grep -v '^database_name' '$cfg.msfragger_params' | grep -v '^output_format' >> $param_file &&
echo "output_format = $output_format.__str__.replace(',mgf','').replace(',','_')" >> $param_file &&
#else
cat $fragger_params >> '$param_file' &&
#end if
]]>
    </token>
    <token name="@FRAGGER_CMD@"><![CDATA[
@CMD_IMPORTS@
@LINK_SCAN_INPUTS@
@LINK_FRAGGER_DATABASE@
@PARAMS_CMD@
msfragger -Xmx\$[ \${GALAXY_MEMORY_MB:-20480} / 1024 ]g fragger.params
@SCAN_INPUTS@
>> "$logfile"
&& ls -ltr
#if 'pepxml' in $output_format:
&& cat *.pepXML > $output_pepxml
#end if
#if 'tsv' in $output_format:
&& cat *.tsv > $output_tsv
#end if
#if 'pin' in $output_format:
&& cat *.pin > $output_pin
#end if
## #if 'mgf' in $output_format:
## && cat *.mgf > $output_mgf
## #end if
]]>
    </token>

    <token name="@MSFAGGER_TSV_COLUMNS@">scannum,precursor_neutral_mass,retention_time,charge,hit_rank,peptide,peptide_prev_aa,peptide_next_aa,protein,num_matched_ions,tot_num_ions,calc_neutral_pep_mass,massdiff,num_tol_term,num_missed_cleavages,modification_info,hyperscore,nextscore,expectscore,best_locs,score_without_delta_mass,best_score_with_delta_mass,second_best_score_with_delta_mass,delta_score,alternative_proteins</token>
    <!-- Are the charge_? columns dependent on a parameter? -->
    <token name="@MSFAGGER_PIN_COLUMNS@">SpecId,Label,ScanNr,ExpMass,retentiontime,rank,abs_ppm,isotope_errors,log10_evalue,hyperscore,delta_hyperscore,matched_ion_num,peptide_length,ntt,nmc,charge_1,charge_2,charge_3,charge_4,charge_5,charge_6,charge_7,Peptide,Proteins</token>

    <token name="@Y_TYPE_MASSES_LABILE_ADP-RIBOSYLATION@">0/114.03169/193.99802/291.97492/406.00661</token>
    <token name="@Y_TYPE_MASSES_MASS-OFFSET-COMMONPTMS@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-N-HCD@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-N-HYBRID@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-N-LFQ@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-N-TMT@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-N-OPEN-HCD@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-N-OPEN-HYBRID@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-O-HCD@">0 203.07937 406.15874 568.21156 730.26438 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-O-HYBRID@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-O-OPEN-HCD@">0 203.07937 406.15874 568.21156 730.26438 349.137279</token>
    <token name="@Y_TYPE_MASSES_GLYCO-O-OPEN-HYBRID@">0 203.07937 406.15874 568.21156 730.26438 349.137279</token>
    <token name="@Y_TYPE_MASSES_ISODTB@">0 203.07937 406.15874 568.21156 730.26438 892.3172 349.137279</token>


    <token name="@MASS_OFFSET_LABILE_ADP-RIBOSYLATION@">0/541.06111</token>
    <token name="@MASS_OFFSET_LABILE_PHOSPHO@">0/79.966331</token>
    <token name="@MASS_OFFSET_MASS-OFFSET-COMMONPTMS@">-105.0248 -89.0299 -33.9877 -32.0085 -30.0106 -18.0106 -17.0265 -2.0157 -1.007825 -0.984 0 0.984 3.9949 12.0 13.9793 14.0157 15.9949 19.9898 21.969392 21.9819 23.95806 26.0157 27.9949 28.0313 28.990164 29.9742 31.972071 31.9898 37.9469 37.955882 42.0106 42.047 43.0058 43.9898 44.985078 47.9847 53.9193 57.0215 58.0055 61.9135 61.921774 68.026215 70.041865 71.0371 79.9568 79.9663 86.000394 100.016 114.042927 119.004099 128.095 146.0579 156.1011 162.0528 173.051 176.0321 178.0477 183.035399 189.046 203.0794 204.1878 210.1984 228.111 229.014009 238.2297 301.9865 340.1006 349.1373 365.1322 365.1322 406.1587 541.06111</token>
    <token name="@MASS_OFFSET_GLYCO-N-HCD@">0 203.07937 349.137279 406.15874 552.216649 568.21156 714.269469 2026.68694 2188.73976 2350.79258 730.26438 876.322289 892.3172 1038.375109 1054.37002 1200.427929 1216.42284 1362.480749 1378.47566 1524.533569 1458.44199 1540.52848 1686.586389 1702.5813 1864.63412 1095.39657 1241.454479 1257.44939 1403.507299 1694.602716 1549.565208 1840.660625 1548.544807 1419.50221 1565.560119 1856.655536 2147.750952 1710.597627 1581.55503 1727.612939 2018.708356 1872.650447 1298.47594 1444.533849 1589.571357 1460.52876 1606.586669 1897.682086 1752.644578 1751.624177 1622.58158 1768.639489 2059.734906 2350.830322 1914.697398 2205.792815 2496.888231 2351.850724 2642.94614 1913.676997 2204.772413 1784.6344 1930.692309 2221.787726 2076.750218 2075.729817 1946.68722 2092.745129 2237.782637 1501.55531 1647.613219 1938.708636 1793.671128 1663.60813 1809.666039 2100.761456 2391.856872 1955.723948 1954.703547 2245.798963 1825.66095 1971.718859 2262.814276 2553.909692 2117.776768 2408.872185 2263.834677 2116.756367 2407.851783 1987.71377 2133.771679 2424.867096 2715.962512 3007.057929 2279.829588 2570.925005 2425.887497 2716.982914 3008.07833 3299.173747 2571.945406 2863.040823 2278.809187 2569.904603 2861.00002 2586.919916 2878.015332 2311.81941 2457.877319 2619.930139 1704.63468 1850.692589 2141.788006 2432.883422 1996.750498 1866.6875 2012.745409 2158.803318 2157.782917 2028.74032 2174.798229 2465.893646 2756.989062 3048.084479 2320.856138 2611.951555 2466.914047 2190.79314 2336.851049 2627.946466 2482.908958 2774.004375 3065.099791 2481.888557 2772.983973 3064.07939 2352.84596 2789.999286 3081.094702 2644.961778 2936.057195 2791.019687 3082.115104 2643.941377 2935.036793 3226.13221 3517.227626 2952.052106 2805.994197 2676.9516 3114.104926 3405.200342 1907.71405 2053.771959 2069.76687 2215.824779 2393.87251 2539.930419 2555.92533 2701.983239 3575.269489 2717.97815 2864.036059 3155.131476 4028.417725 3009.073567 2110.79342 2256.851329 2272.84624 2434.89906 2580.956969 2759.0047 2921.05752 3083.11034 3229.168249 3448.24253 2313.87279 2459.930699 2475.92561 2621.983519 2800.03125 2946.089159 3432.247619</token>
    <token name="@MASS_OFFSET_GLYCO-N-HYBRID@">0 203.07937 349.137279 406.15874 552.216649 568.21156 714.269469 2026.68694 2188.73976 2350.79258 730.26438 876.322289 892.3172 1038.375109 1054.37002 1200.427929 1216.42284 1362.480749 1378.47566 1524.533569 1458.44199 1540.52848 1686.586389 1702.5813 1864.63412 1095.39657 1241.454479 1257.44939 1403.507299 1694.602716 1549.565208 1840.660625 1548.544807 1419.50221 1565.560119 1856.655536 2147.750952 1710.597627 1581.55503 1727.612939 2018.708356 1872.650447 1298.47594 1444.533849 1589.571357 1460.52876 1606.586669 1897.682086 1752.644578 1751.624177 1622.58158 1768.639489 2059.734906 2350.830322 1914.697398 2205.792815 2496.888231 2351.850724 2642.94614 1913.676997 2204.772413 1784.6344 1930.692309 2221.787726 2076.750218 2075.729817 1946.68722 2092.745129 2237.782637 1501.55531 1647.613219 1938.708636 1793.671128 1663.60813 1809.666039 2100.761456 2391.856872 1955.723948 1954.703547 2245.798963 1825.66095 1971.718859 2262.814276 2553.909692 2117.776768 2408.872185 2263.834677 2116.756367 2407.851783 1987.71377 2133.771679 2424.867096 2715.962512 3007.057929 2279.829588 2570.925005 2425.887497 2716.982914 3008.07833 3299.173747 2571.945406 2863.040823 2278.809187 2569.904603 2861.00002 2586.919916 2878.015332 2311.81941 2457.877319 2619.930139 1704.63468 1850.692589 2141.788006 2432.883422 1996.750498 1866.6875 2012.745409 2158.803318 2157.782917 2028.74032 2174.798229 2465.893646 2756.989062 3048.084479 2320.856138 2611.951555 2466.914047 2190.79314 2336.851049 2627.946466 2482.908958 2774.004375 3065.099791 2481.888557 2772.983973 3064.07939 2352.84596 2789.999286 3081.094702 2644.961778 2936.057195 2791.019687 3082.115104 2643.941377 2935.036793 3226.13221 3517.227626 2952.052106 2805.994197 2676.9516 3114.104926 3405.200342 1907.71405 2053.771959 2069.76687 2215.824779 2393.87251 2539.930419 2555.92533 2701.983239 3575.269489 2717.97815 2864.036059 3155.131476 4028.417725 3009.073567 2110.79342 2256.851329 2272.84624 2434.89906 2580.956969 2759.0047 2921.05752 3083.11034 3229.168249 3448.24253 2313.87279 2459.930699 2475.92561 2621.983519 2800.03125 2946.089159 3432.247619</token>
    <token name="@MASS_OFFSET_GLYCO-N-LFQ@">0 203.07937 349.137279 406.15874 552.216649 568.21156 714.269469 2026.68694 2188.73976 2350.79258 730.26438 876.322289 892.3172 1038.375109 1054.37002 1200.427929 1216.42284 1362.480749 1378.47566 1524.533569 1458.44199 1540.52848 1686.586389 1702.5813 1864.63412 1095.39657 1241.454479 1257.44939 1403.507299 1694.602716 1549.565208 1840.660625 1548.544807 1419.50221 1565.560119 1856.655536 2147.750952 1710.597627 1581.55503 1727.612939 2018.708356 1872.650447 1298.47594 1444.533849 1589.571357 1460.52876 1606.586669 1897.682086 1752.644578 1751.624177 1622.58158 1768.639489 2059.734906 2350.830322 1914.697398 2205.792815 2496.888231 2351.850724 2642.94614 1913.676997 2204.772413 1784.6344 1930.692309 2221.787726 2076.750218 2075.729817 1946.68722 2092.745129 2237.782637 1501.55531 1647.613219 1938.708636 1793.671128 1663.60813 1809.666039 2100.761456 2391.856872 1955.723948 1954.703547 2245.798963 1825.66095 1971.718859 2262.814276 2553.909692 2117.776768 2408.872185 2263.834677 2116.756367 2407.851783 1987.71377 2133.771679 2424.867096 2715.962512 3007.057929 2279.829588 2570.925005 2425.887497 2716.982914 3008.07833 3299.173747 2571.945406 2863.040823 2278.809187 2569.904603 2861.00002 2586.919916 2878.015332 2311.81941 2457.877319 2619.930139 1704.63468 1850.692589 2141.788006 2432.883422 1996.750498 1866.6875 2012.745409 2158.803318 2157.782917 2028.74032 2174.798229 2465.893646 2756.989062 3048.084479 2320.856138 2611.951555 2466.914047 2190.79314 2336.851049 2627.946466 2482.908958 2774.004375 3065.099791 2481.888557 2772.983973 3064.07939 2352.84596 2789.999286 3081.094702 2644.961778 2936.057195 2791.019687 3082.115104 2643.941377 2935.036793 3226.13221 3517.227626 2952.052106 2805.994197 2676.9516 3114.104926 3405.200342 1907.71405 2053.771959 2069.76687 2215.824779 2393.87251 2539.930419 2555.92533 2701.983239 3575.269489 2717.97815 2864.036059 3155.131476 4028.417725 3009.073567 2110.79342 2256.851329 2272.84624 2434.89906 2580.956969 2759.0047 2921.05752 3083.11034 3229.168249 3448.24253 2313.87279 2459.930699 2475.92561 2621.983519 2800.03125 2946.089159 3432.247619</token>
    <token name="@MASS_OFFSET_GLYCO-N-TMT@">0 203.07937 349.137279 406.15874 552.216649 568.21156 714.269469 2026.68694 2188.73976 2350.79258 730.26438 876.322289 892.3172 1038.375109 1054.37002 1200.427929 1216.42284 1362.480749 1378.47566 1524.533569 1458.44199 1540.52848 1686.586389 1702.5813 1864.63412 1095.39657 1241.454479 1257.44939 1403.507299 1694.602716 1549.565208 1840.660625 1548.544807 1419.50221 1565.560119 1856.655536 2147.750952 1710.597627 1581.55503 1727.612939 2018.708356 1872.650447 1298.47594 1444.533849 1589.571357 1460.52876 1606.586669 1897.682086 1752.644578 1751.624177 1622.58158 1768.639489 2059.734906 2350.830322 1914.697398 2205.792815 2496.888231 2351.850724 2642.94614 1913.676997 2204.772413 1784.6344 1930.692309 2221.787726 2076.750218 2075.729817 1946.68722 2092.745129 2237.782637 1501.55531 1647.613219 1938.708636 1793.671128 1663.60813 1809.666039 2100.761456 2391.856872 1955.723948 1954.703547 2245.798963 1825.66095 1971.718859 2262.814276 2553.909692 2117.776768 2408.872185 2263.834677 2116.756367 2407.851783 1987.71377 2133.771679 2424.867096 2715.962512 3007.057929 2279.829588 2570.925005 2425.887497 2716.982914 3008.07833 3299.173747 2571.945406 2863.040823 2278.809187 2569.904603 2861.00002 2586.919916 2878.015332 2311.81941 2457.877319 2619.930139 1704.63468 1850.692589 2141.788006 2432.883422 1996.750498 1866.6875 2012.745409 2158.803318 2157.782917 2028.74032 2174.798229 2465.893646 2756.989062 3048.084479 2320.856138 2611.951555 2466.914047 2190.79314 2336.851049 2627.946466 2482.908958 2774.004375 3065.099791 2481.888557 2772.983973 3064.07939 2352.84596 2789.999286 3081.094702 2644.961778 2936.057195 2791.019687 3082.115104 2643.941377 2935.036793 3226.13221 3517.227626 2952.052106 2805.994197 2676.9516 3114.104926 3405.200342 1907.71405 2053.771959 2069.76687 2215.824779 2393.87251 2539.930419 2555.92533 2701.983239 3575.269489 2717.97815 2864.036059 3155.131476 4028.417725 3009.073567 2110.79342 2256.851329 2272.84624 2434.89906 2580.956969 2759.0047 2921.05752 3083.11034 3229.168249 3448.24253 2313.87279 2459.930699 2475.92561 2621.983519 2800.03125 2946.089159 3432.247619</token>
    <token name="@MASS_OFFSET_GLYCO-O-HCD@">0 146.0579 203.0794 349.1373 365.1322 406.1587 494.1748 511.1901 527.185 568.2116 609.2381 640.2327 656.2276 673.2429 689.2378 697.2541 698.2746 714.2695 730.2644 755.296 771.2909 786.2906 802.2855 812.3175 818.2804 835.2957 843.312 851.2907 859.307 876.3223 892.3172 917.3488 933.3438 974.3703 989.37 997.3486 1005.3649 1006.3853 1013.3435 1015.3969 1021.3598 1038.3751 1046.3914 1054.37 1079.4017 1095.3966 1136.4231 1151.4228 1159.4014 1183.4126 1192.4493 1200.4279 1216.4228 1218.4762 1224.4391 1241.4545 1257.4494 1282.481 1298.4759 1307.5127 1321.4542 1339.5025 1354.5021 1362.4807 1378.4757 1386.492 1395.5287 1403.5073 1444.5338 1460.5288 1501.5553 1524.5336 1532.5499 1540.5285 1548.5448 1557.5815 1565.5601 1573.5764 1574.5968 1589.5713 1606.5867 1622.5816 1647.6132 1663.6081 1686.5864 1704.6347 1727.6129 1752.6446 1768.6395 1825.6609 1831.6239 1866.6875 1905.6607 1913.677 1914.6974 1930.6923 1971.7189 1987.7138 2018.7083 2028.7403 2092.7451 2117.7768 2133.7717 2174.7982 2190.7931 2213.7714 2352.846 2393.8725 2498.9039 2555.9253 2701.9832</token>
    <token name="@MASS_OFFSET_GLYCO-O-HYBRID@">0 146.0579 203.0794 349.1373 365.1322 406.1587 494.1748 511.1901 527.185 568.2116 609.2381 640.2327 656.2276 673.2429 689.2378 697.2541 698.2746 714.2695 730.2644 755.296 771.2909 786.2906 802.2855 812.3175 818.2804 835.2957 843.312 851.2907 859.307 876.3223 892.3172 917.3488 933.3438 974.3703 989.37 997.3486 1005.3649 1006.3853 1013.3435 1015.3969 1021.3598 1038.3751 1046.3914 1054.37 1079.4017 1095.3966 1136.4231 1151.4228 1159.4014 1183.4126 1192.4493 1200.4279 1216.4228 1218.4762 1224.4391 1241.4545 1257.4494 1282.481 1298.4759 1307.5127 1321.4542 1339.5025 1354.5021 1362.4807 1378.4757 1386.492 1395.5287 1403.5073 1444.5338 1460.5288 1501.5553 1524.5336 1532.5499 1540.5285 1548.5448 1557.5815 1565.5601 1573.5764 1574.5968 1589.5713 1606.5867 1622.5816 1647.6132 1663.6081 1686.5864 1704.6347 1727.6129 1752.6446 1768.6395 1825.6609 1831.6239 1866.6875 1905.6607 1913.677 1914.6974 1930.6923 1971.7189 1987.7138 2018.7083 2028.7403 2092.7451 2117.7768 2133.7717 2174.7982 2190.7931 2213.7714 2352.846 2393.8725 2498.9039 2555.9253 2701.9832</token>


<!--
add_Nterm_peptide = 0.000000
add_Nterm_protein = 0.000000
add_Cterm_peptide = 0.000000
add_Cterm_protein = 0.000000
add_A_alanine = 0.000000
add_C_cysteine = 57.021464
add_D_aspartic_acid = 0.000000
add_E_glutamic_acid = 0.000000
add_F_phenylalanine = 0.000000
add_G_glycine = 0.000000
add_H_histidine = 0.000000
add_I_isoleucine = 0.000000
add_K_lysine = 0.000000
add_L_leucine = 0.000000
add_M_methionine = 0.000000
add_N_asparagine = 0.000000
add_P_proline = 0.000000
add_Q_glutamine = 0.000000
add_R_arginine = 0.000000
add_S_serine = 0.000000
add_T_threonine = 0.000000
add_V_valine = 0.000000
add_W_tryptophan = 0.000000
add_Y_tyrosine = 0.000000
add_B_user_amino_acid = 0.000000
add_J_user_amino_acid = 0.000000
add_O_user_amino_acid = 0.000000              # O = pyrrolysine (255.15829 Da)
add_U_user_amino_acid = 0.000000              # U = selenocysteine (150.95363 Da)
add_X_user_amino_acid = 0.000000
add_Z_user_amino_acid = 0.000000

    <xml name="static_mod_options">
    - methylation of K : 14.015650
    - oxidation of M : 15.994915
    - carboxymethyl C : 58.005479
    - carbamidomethyl C : 57.021464
    - deamidation of N and Q : 0.984016
    - propionamide C : 71.037114
    - phosphorylation of S : 79.966331
    - phosphorylation of T : 79.966331
    - phosphorylation of Y : 79.966331
    - M cleavage from protein n-term : -131.040485
    - acetylation of protein n-term : 42.010565
    - methylation of protein n-term : 14.015650
    - tri-methylation of protein n-term : 42.046950
    - beta methythiolation of D : 45.987721
    - methylation of Q : 14.015650
    - tri-methylation of K : 42.046950
    - methylation of D : 14.015650
    - methylation of E : 14.015650
    - methylation of peptide c-term : 14.015650
    - tri-deuteromethylation of D : 17.034480
    - tri-deuteromethylation of E : 17.034480
    - tri-deuteromethylation of peptide c-term : 17.034480
    - n-formyl met addition : 159.035399
    - 2-amino-3-oxo-butanoic acid T : -2.015650
    - acetylation of K : 42.010565
    - amidation of peptide c-term : -0.984016
    - beta-methylthiolation of D (duplicate of 13) : 45.987721
    - carboxyamidomethylation of K : 57.021464
    - carboxyamidomethylation of H : 57.021464
    - carboxyamidomethylation of D : 57.021464
    - carboxyamidomethylation of E : 57.021464
    - carbamylation of K : 43.005814
    - carbamylation of n-term peptide : 43.005814
    - citrullination of R : 0.984016
    - oxidation of C to cysteic acid : 47.984744
    - di-iodination of Y : 251.793296
    - di-methylation of K : 28.031300
    - di-methylation of R : 28.031300
    - di-methylation of peptide n-term : 28.031300
    - oxidation of F to dihydroxyphenylalanine : 31.989829
    - gammathiopropionylation of K : 87.998285
    - gammathiopropionylation of peptide n-term : 87.998285
    - farnesylation of C : 204.187801
    - formylation of K : 27.994915
    - formylation of peptide n-term : 27.994915
    - oxidation of W to formylkynurenin : 31.989829
    - fluorophenylalanine : 17.990578
    - beta-carboxylation of D : 43.989829
    - gamma-carboxylation of E : 43.989829
    - geranyl-geranyl : 272.250401
    - glucuronylation of protein n-term : 176.032088
    - glutathione disulfide : 305.068156
    - ubiquitinylation residue : 114.042927
    - guanidination of K : 42.021798
    - oxidation of H to N : -23.015984
    - oxidation of H to D : -22.031969
    - homoserine : -29.992806
    - homoserine lactone : -48.003371
    - oxidation of W to hydroxykynurenin : 19.989829
    - hydroxylation of D : 15.994915
    - hydroxylation of K : 15.994915
    - hydroxylation of N : 15.994915
    - hydroxylation of P : 15.994915
    - hydroxylation of F : 15.994915
    - hydroxylation of Y : 15.994915
    - iodination of Y : 125.896648
    - oxidation of W to kynurenin : 3.994915
    - lipoyl K : 188.032956
    - methyl ester of peptide c-term (duplicate of 18) : 14.015650
    - methyl ester of D : 14.015650
    - methyl ester of E (duplicate of 17) : 14.015650
    - methyl ester of S : 14.015650
    - methyl ester of Y : 14.015650
    - methyl C : 14.015650
    - methyl H : 14.015650
    - methyl N : 14.015650
    - methylation of peptide n-term : 14.015650
    - methyl R : 14.015650
    - myristoleylation of G : 208.182715
    - myristoyl-4H of G : 206.167065
    - myristoylation of peptide n-term G : 210.198366
    - myristoylation of K : 210.198366
    - formylation of protein n-term : 27.994915
    - NEM C : 125.047679
    - NIPCAM : 99.068414
    - oxidation of W to nitro : 44.985078
    - oxidation of Y to nitro : 44.985078
    - O18 on peptide n-term : 2.004246
    - di-O18 on peptide n-term : 4.008490
    - oxidation of H : 15.994915
    - oxidation of W : 15.994915
    - phosphopantetheine S : 340.085794
    - palmitoylation of C : 238.229666
    - palmitoylation of K : 238.229666
    - palmitoylation of S : 238.229666
    - palmitoylation of T : 238.229666
    - phosphorylation of S with prompt loss : -18.010565
    - phosphorylation of T with prompt loss : -18.010565
    - phosphorylation with prompt loss on Y : -18.010565
    - phosphorylation with neutral loss on C : 79.966331
    - phosphorylation with neutral loss on D : 79.966331
    - phosphorylation with neutral loss on H : 79.966331
    - propionyl light K : 56.026215
    - propionyl light on peptide n-term : 56.026215
    - propionyl heavy K : 59.036279
    - propionyl heavy peptide n-term : 59.036279
    - pyridyl K : 119.037114
    - pyridyl peptide n-term : 119.037114
    - pyro-cmC : -17.026549
    - pyro-glu from n-term E : -18.010565
    - pyro-glu from n-term Q : -17.026549
    - oxidation of P to pyroglutamic acid : 13.979265
    - s-pyridylethylation of C : 105.057849
    - SeMet : 47.944449
    - sulfation of Y : 79.956815
    - sulphone of M : 31.989829
    - tri-iodination of Y : 377.689944
    - tri-methylation of R : 42.046950
    - n-acyl diglyceride cysteine : 788.725777
    - ICAT light : 227.126991
    - ICAT heavy : 236.157185
    - CAMthiopropanoyl K : 145.019749
    - phosphorylation with neutral loss on S : 79.966331
    - phosphorylation with neutral loss on T : 79.966331
    - phosphorylation of S with ETD loss : 79.966331
    - phosphorylation of T with ETD loss : 79.966331
    - heavy arginine-13C6 : 6.020129
    - heavy arginine-13C6-15N4 : 10.008269
    - heavy lysine-13C6 : 6.020129
    - PNGasF in O18 water : 2.988261
    - beta elimination of S : -18.010565
    - beta elimination of T : -18.010565
    - oxidation of C to sulfinic acid : 31.989829
    - arginine to ornithine : -42.021798
    - dehydro of S and T : -18.010565
    - carboxykynurenin of W : 47.984744
    - sumoylation of K : 484.228200
    - iTRAQ114 on nterm : 144.105918
    - iTRAQ114 on K : 144.105918
    - iTRAQ114 on Y : 144.105918
    - iTRAQ115 on nterm : 144.099599
    - iTRAQ115 on K : 144.099599
    - iTRAQ115 on Y : 144.099599
    - iTRAQ116 on nterm : 144.102063
    - iTRAQ116 on K : 144.102063
    - iTRAQ116 on Y : 144.102063
    - iTRAQ117 on nterm : 144.102063
    - iTRAQ117 on K : 144.102063
    - iTRAQ117 on Y : 144.102063
    - MMTS on C : 45.987721
    - heavy lysine - 2H4 : 4.025107
    - heavy lysine - 13C6 15N2 : 8.014199
    - Asparagine HexNAc : 203.079373
    - Asparagine dHexHexNAc : 349.137281
    - Serine HexNAc : 203.079373
    - Threonine HexNAc : 203.079373
    - palmitoleyl of S : 236.214016
    - palmitoleyl of C : 236.214016
    - palmitoleyl of T : 236.214016
    - CHD2-di-methylation of K : 32.056407
    - CHD2-di-methylation of peptide n-term : 32.056407
    - Maleimide-PEO2-Biotin of C : 525.225719
    - phosphorylation of H : 79.966331
    - oxidation of C : 15.994915
    - oxidation of Y (duplicate of 64) : 15.994915
    - Uniblue A on K : 484.039891
    - deamidation of N : 0.984016
    - trideuteration of L (SILAC) : 3.018830
    - TMT duplex on K : 225.155833
    - TMT duplex on n-term peptide : 225.155833
    - TMT 6-plex on K : 229.162932
    - TMT 6-plex on n-term peptide : 229.162932
    - iTRAQ8plex:13C(7)15N(1) on nterm : 304.205360
    - iTRAQ8plex:13C(7)15N(1) on K : 304.205360
    - iTRAQ8plex:13C(7)15N(1) on Y : 304.205360
    - iTRAQ8plex:13C(6)15N(2) on nterm : 304.199040
    - iTRAQ8plex:13C(6)15N(2) on K : 304.199040
    - iTRAQ8plex:13C(6)15N(2) on Y : 304.199040
    - selenocysteine : 47.944449
    - carboxymethylated selenocysteine : 105.949928
    </xml>
-->
    <token name="@MSFRAGGER_LICENSE_AGREEMENT@">
MSFragger is available freely for academic research and educational purposes only. I have read the ACADEMIC license for MSFragger software.  
http://msfragger-upgrader.nesvilab.org/upgrader/MSFragger-LICENSE.pdf   
This license provides with non-exclusive, non-transferable right to use MSFragger solely for academic research, non-commercial or educational purposes. I agree to be subject to the terms and conditions of this license. I understand that to use MSFragger for other purposes requires a commercial license from the University of Michigan Office of Tech Transfer.
    </token>
    <token name="@THERMO_RAW_READER_LICENSE_AGREEMENT@">
I agree to the terms of Thermo (c) Raw File Reader License Agreement.  
http://msfragger-upgrader.nesvilab.org/upgrader/RawFileRdr_License_Agreement_RevA.pdf
    </token>
    <token name="@BRUKER_LICENSE_AGREEMENT@">
I agree to the terms of Bruker SDK library distribution conditions.  
http://msfragger-upgrader.nesvilab.org/upgrader/redist.txt
    </token>
    <token name="@MSFRAGGER_LICENSE_AGREEMENTS@">
@MSFRAGGER_LICENSE_AGREEMENT@
@THERMO_RAW_READER_LICENSE_AGREEMENT@
@BRUKER_LICENSE_AGREEMENT@
    </token>

    <xml name="msfragger_license_agreements">
        <param name="msfragger_license_agreements" type="boolean" truevalue="" falsevalue="" checked="false" label="I understand that MSFragger is available freely for academic research and educational purposes only.">
            <help>@MSFRAGGER_LICENSE_AGREEMENT@</help>
        </param>
    </xml>
    <token name="@AGREE_TO_LICENSE@">
#if not $msfragger_license_agreements
    echo "You must agree to the MSFragger license!"; exit 1;
#end if
    </token>
    <xml name="msfragger_citations">
        <citation type="doi">doi:10.1038/nmeth.4256</citation>
        <citation type="doi">doi:10.1038/s41467-020-17921-y</citation>
        <citation type="doi">doi:10.1038/s41592-020-0967-9</citation>
    </xml>
</macros>
